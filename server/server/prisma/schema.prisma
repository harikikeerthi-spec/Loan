generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String              @id @default(uuid())
  email             String              @unique
  firstName         String?
  lastName          String?
  phoneNumber       String?
  dateOfBirth       DateTime?
  mobile            String
  password          String
  role              String              @default("user")  // user, admin, super_admin
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @default(now()) @updatedAt
  blogs             Blog[]              @relation("AuthorBlogs")
  loanApplications  LoanApplication[]
  documents         UserDocument[]
  adminProfile      AdminProfile?       @relation("AdminUser")
  comments          Comment[]           @relation("CommentAuthor")
  auditLogs         AuditLog[]          @relation("AuditInitiator")
  forumPosts        ForumPost[]
  forumComments     ForumComment[]
}

model AdminProfile {
  id              String    @id @default(uuid())
  userId          String    @unique
  user            User      @relation("AdminUser", fields: [userId], references: [id], onDelete: Cascade)
  
  adminTitle      String?
  department      String?
  bio             String?
  profileImage    String?
  
  canApproveBlogs Boolean   @default(false)
  canManageUsers  Boolean   @default(false)
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  @@index([userId])
}

model Blog {
  id              String    @id @default(uuid())
  title           String
  slug            String    @unique
  excerpt         String
  content         String    @db.Text
  category        String
  
  authorId        String?
  author          User?     @relation("AuthorBlogs", fields: [authorId], references: [id], onDelete: SetNull)
  authorName      String
  authorImage     String?
  authorRole      String?
  
  featuredImage   String?
  readTime        Int       @default(5)
  views           Int       @default(0)
  isFeatured      Boolean   @default(false)
  
  status          String    @default("draft")  // draft, pending, published
  visibility      String    @default("private")  // private, public
  isPublished     Boolean   @default(false)
  publishedAt     DateTime?
  
  submittedAt     DateTime?
  approvedAt      DateTime?
  approvedBy      String?
  rejectionReason String?
  
  comments        Comment[]
  tags            BlogTag[]
  auditLogs       AuditLog[]  @relation("BlogAuditLogs")
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  @@index([authorId])
  @@index([status])
  @@index([visibility])
  @@index([isPublished])
  @@index([isFeatured])
  @@index([category])
  @@index([publishedAt])
}

model Comment {
  id        String    @id @default(uuid())
  blogId    String
  blog      Blog      @relation(fields: [blogId], references: [id], onDelete: Cascade)
  
  userId    String?
  user      User?     @relation("CommentAuthor", fields: [userId], references: [id], onDelete: SetNull)
  
  author    String
  content   String    @db.Text
  parentId  String?
  parent    Comment?  @relation("CommentReplies", fields: [parentId], references: [id])
  replies   Comment[] @relation("CommentReplies")
  
  status    String    @default("approved")  // pending, approved, spam
  likes     Int       @default(0)
  likesData CommentLike[]
  
  createdAt DateTime  @default(now())
  updatedAt DateTime  @default(now()) @updatedAt
  
  @@index([blogId])
  @@index([userId])
  @@index([parentId])
}

model CommentLike {
  id        String   @id @default(uuid())
  commentId String
  userId    String   // IP address or user identifier for anonymous likes
  createdAt DateTime @default(now())
  comment   Comment  @relation(fields: [commentId], references: [id])

  @@unique([commentId, userId])
  @@index([commentId])
  @@index([userId])
}

model Tag {
  id        String    @id @default(uuid())
  name      String    @unique
  slug      String    @unique
  createdAt DateTime  @default(now())
  blogs     BlogTag[]
}

model BlogTag {
  blogId String
  tagId  String
  blog   Blog @relation(fields: [blogId], references: [id])
  tag    Tag  @relation(fields: [tagId], references: [id])

  @@id([blogId, tagId])
  @@index([tagId])
}

model LoanApplication {
  id        String   @id @default(uuid())
  userId    String
  bank      String
  loanType  String   // education, home, personal, business, vehicle
  amount    Float
  purpose   String?
  status    String   @default("pending") // pending, processing, approved, rejected
  date      DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId])
  @@index([status])
}

model UserDocument {
  id        String   @id @default(uuid())
  userId    String
  docType   String   // aadhar, pan, passport, 10th, 12th, degree
  uploaded  Boolean  @default(false)
  status    String   @default("pending") // pending, uploaded, verified, rejected
  filePath  String?
  uploadedAt DateTime?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([userId, docType])
  @@index([userId])
  @@index([docType])
}

model AuditLog {
  id            String   @id @default(uuid())
  action        String   // create, update, publish, delete
  entityType    String   // blog, user, comment
  entityId      String
  
  initiatedBy   String
  initiator     User     @relation("AuditInitiator", fields: [initiatedBy], references: [id], onDelete: SetNull)
  
  changes       Json
  ipAddress     String?
  userAgent     String?
  
  blog          Blog?    @relation("BlogAuditLogs", fields: [entityId], references: [id], onDelete: SetNull)
  
  createdAt     DateTime @default(now())
  
  @@index([entityType])
  @@index([entityId])
  @@index([initiatedBy])
  @@index([createdAt])
}

model ForumPost {
  id          String   @id @default(uuid())
  title       String?
  content     String   @db.Text
  category    String   // loan, visa, universities, gre, accommodation, etc.
  tags        String[]
  
  authorId    String
  author      User     @relation(fields: [authorId], references: [id], onDelete: Cascade)
  
  likes       Int      @default(0)
  views       Int      @default(0)
  isMentorOnly Boolean @default(false)
  
  comments    ForumComment[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([category])
  @@index([authorId])
  @@index([createdAt])
}

model ForumComment {
  id        String    @id @default(uuid())
  postId    String
  post      ForumPost @relation(fields: [postId], references: [id], onDelete: Cascade)
  
  authorId  String
  author    User      @relation(fields: [authorId], references: [id], onDelete: Cascade)
  
  content   String    @db.Text
  likes     Int       @default(0)
  
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  
  @@index([postId])
  @@index([authorId])
}

// ==================== COMMUNITY MODELS ====================

model Mentor {
  id                String           @id @default(uuid())
  name              String
  email             String           @unique
  phone             String?
  
  university        String
  degree            String
  country           String
  category          String?          // MBA, Engineering, Medical, etc.
  
  loanBank          String
  loanAmount        String
  loanType          String?
  interestRate      String?
  
  bio               String           @db.Text
  expertise         String[]         // Array of expertise areas
  linkedIn          String?
  image             String?
  
  rating            Float            @default(0)
  studentsMentored  Int              @default(0)
  
  isActive          Boolean          @default(true)
  isApproved        Boolean          @default(false)
  rejectionReason   String?
  
  bookings          MentorBooking[]
  
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  
  @@index([country])
  @@index([university])
  @@index([isActive])
  @@index([isApproved])
  @@index([rating])
}

model MentorBooking {
  id              String   @id @default(uuid())
  mentorId        String
  mentor          Mentor   @relation(fields: [mentorId], references: [id], onDelete: Cascade)
  
  studentName     String
  studentEmail    String
  studentPhone    String?
  preferredDate   String
  preferredTime   String
  message         String?  @db.Text
  
  status          String   @default("pending")  // pending, confirmed, cancelled, completed
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@index([mentorId])
  @@index([status])
  @@index([studentEmail])
}

model CommunityEvent {
  id              String              @id @default(uuid())
  title           String
  description     String              @db.Text
  type            String              // webinar, qa, networking, workshop
  
  date            String
  time            String
  duration        Int                 // in minutes
  
  speaker         String?
  speakerTitle    String?
  
  maxAttendees    Int?
  attendeesCount  Int                 @default(0)
  isFree          Boolean             @default(true)
  
  recordingUrl    String?
  isFeatured      Boolean             @default(false)
  
  registrations   EventRegistration[]
  
  category        String?             // loan, visa, universities, etc.

  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  
  @@index([type])
  @@index([category])
  @@index([date])
  @@index([isFeatured])
}

model EventRegistration {
  id        String         @id @default(uuid())
  eventId   String
  event     CommunityEvent @relation(fields: [eventId], references: [id], onDelete: Cascade)
  
  name      String
  email     String
  phone     String?
  
  createdAt DateTime       @default(now())
  
  @@unique([eventId, email])
  @@index([eventId])
  @@index([email])
}

model SuccessStory {
  id            String   @id @default(uuid())
  name          String
  email         String
  
  university    String
  country       String
  degree        String
  category      String?  // MBA, Engineering, Medical, etc.
  
  loanAmount    String
  bank          String
  interestRate  String?
  
  story         String   @db.Text
  tips          String?  @db.Text
  image         String?
  
  isApproved    Boolean  @default(false)
  isFeatured    Boolean  @default(false)
  rejectionReason String?
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@index([country])
  @@index([category])
  @@index([isApproved])
  @@index([isFeatured])
}

model CommunityResource {
  id            String   @id @default(uuid())
  title         String
  description   String   @db.Text
  type          String   // guide, template, checklist, video
  category      String
  
  fileUrl       String?
  downloadUrl   String?
  thumbnailUrl  String?
  
  downloads     Int      @default(0)
  isFeatured    Boolean  @default(false)
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@index([type])
  @@index([category])
  @@index([downloads])
  @@index([isFeatured])
}

// ==================== REFERENCE DATA MODELS ====================

model LoanType {
  id                String   @id @default(uuid())
  name              String   @unique  // e.g., "Education Loan", "Personal Loan"
  category          String              // e.g., "Secured", "Unsecured"
  description       String   @db.Text
  features          String[]            // Array of key features
  eligibility       String   @db.Text
  documentsRequired String[]
  interestRateMin   Float
  interestRateMax   Float
  loanAmountMin     String
  loanAmountMax     String
  repaymentPeriod   String              // e.g., "5-15 years"
  processingTime    String              // e.g., "7-14 days"
  isPopular         Boolean  @default(false)
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  @@index([category])
  @@index([isPopular])
}

model University {
  id              String   @id @default(uuid())
  name            String
  country         String
  city            String?
  state           String?
  ranking         Int?
  worldRanking    Int?
  type            String              // e.g., "Public", "Private"
  established     Int?
  website         String?
  description     String?  @db.Text
  popularCourses  String[]
  averageFees     String?
  acceptanceRate  Float?
  scholarships    Boolean  @default(false)
  logoUrl         String?
  imageUrl        String?
  isFeatured      Boolean  @default(false)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@index([country])
  @@index([ranking])
  @@index([isFeatured])
  @@unique([name, country])
}

model Bank {
  id                    String   @id @default(uuid())
  name                  String   @unique
  shortName             String?
  country               String   @default("India")
  type                  String              // e.g., "Public", "Private", "NBFC"
  loanTypes             String[]            // Types of loans offered
  educationLoan         Boolean  @default(true)
  interestRateMin       Float
  interestRateMax       Float
  maxLoanAmount         String
  collateralRequired    Boolean
  collateralFreeLimit   String?
  processingFee         String
  processingTime        String
  features              String[]
  website               String?
  contactNumber         String?
  email                 String?
  logoUrl               String?
  isPopular             Boolean  @default(false)
  
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  
  @@index([country])
  @@index([type])
  @@index([isPopular])
}

model Country {
  id                    String   @id @default(uuid())
  name                  String   @unique
  code                  String   @unique  // e.g., "US", "UK"
  region                String              // e.g., "North America", "Europe"
  popularForStudy       Boolean  @default(false)
  universities          Int      @default(0)
  averageTuitionFee     String?
  averageLivingCost     String?
  studyDuration         String?             // e.g., "1-2 years for Masters"
  visaType              String?
  visaProcessingTime    String?
  workPermit            Boolean  @default(false)
  postStudyWorkVisa     String?
  popularCities         String[]
  currency              String
  language              String[]
  flagUrl               String?
  description           String?  @db.Text
  
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  
  @@index([region])
  @@index([popularForStudy])
}

model Scholarship {
  id                String   @id @default(uuid())
  name              String
  provider          String
  country           String
  eligibleCountries String[]            // Countries students can be from
  amount            String
  type              String              // e.g., "Merit-based", "Need-based", "Sports"
  description       String   @db.Text
  eligibility       String   @db.Text
  applicationProcess String  @db.Text
  deadline          String?
  website           String?
  isActive          Boolean  @default(true)
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  @@index([country])
  @@index([isActive])
}

model Course {
  id              String   @id @default(uuid())
  name            String
  level           String              // e.g., "Undergraduate", "Masters", "PhD"
  field           String              // e.g., "Engineering", "Business", "Medicine"
  duration        String
  description     String?  @db.Text
  averageFees     String?
  popularCountries String[]
  careerProspects String[]
  averageSalary   String?
  isPopular       Boolean  @default(false)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@index([level])
  @@index([field])
  @@index([isPopular])
}
