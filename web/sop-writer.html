<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Statement of Purpose Generator - AI Powered | LoanHero</title>

    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Serif:ital,wght@0,100..900;1,100..900&family=Noto+Sans:ital,wght@0,100..900;1,100..900&display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet" />
    <link href="assets/css/main.css" rel="stylesheet" />

    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: "#6605c7",
                        secondary: "#a855f7",
                        accent: "#e0c389",
                    }
                }
            }
        };
    </script>
    <style>
        /* SOP Specific Styles */
        .sop-preview {
            background: rgba(255, 255, 255, 0.98);
            border: 2px solid #e5e7eb;
            border-radius: 16px;
            padding: 48px;
            line-height: 1.9;
            color: #1f2937;
            font-family: 'Noto Serif', serif;
            max-height: 800px;
            overflow-y: auto;
        }

        .dark .sop-preview {
            background: rgba(31, 41, 55, 0.9);
            border-color: #4b5563;
            color: #e5e7eb;
        }

        .sop-section-title {
            color: #6605c7;
            font-size: 1.5rem;
            font-weight: 700;
            margin-top: 2rem;
            margin-bottom: 1rem;
        }

        .dark .sop-section-title {
            color: #a855f7;
        }

        .analysis-card {
            border-left: 5px solid #6605c7;
        }

        .strength-item {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .improvement-item {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .section-score {
            display: inline-block;
            background: linear-gradient(135deg, #6605c7 0%, #a855f7 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.875rem;
        }
    </style>
</head>

<body
    class="bg-background-light dark:bg-background-dark min-h-screen font-sans transition-colors duration-500 text-gray-900 dark:text-gray-100">

    <!-- Background -->
    <div class="fixed inset-0 z-0 bg-background-light dark:bg-background-dark pointer-events-none">
        <div class="absolute inset-0 bg-mesh-gradient opacity-90"></div>
    </div>

    <!-- Navigation -->
    <div id="navbar-placeholder"></div>

    <!-- Main Content -->
    <main class="pt-28 pb-16 px-4 md:px-6 relative z-10">
        <div class="max-w-7xl mx-auto">

            <!-- Header -->
            <div class="text-center mb-12">
                <div class="inline-block mb-4">
                    <span class="text-6xl">üéì</span>
                </div>
                <h1 class="text-4xl md:text-5xl font-bold font-display text-gray-900 dark:text-white mb-4">
                    AI-Powered Statement of Purpose Generator
                </h1>
                <p class="text-lg text-gray-600 dark:text-gray-300 max-w-3xl mx-auto">
                    Generate professional Statements of Purpose for university applications with AI-powered analysis,
                    improvement suggestions, and section-by-section scoring
                </p>
            </div>

            <!-- Two-Column Layout -->
            <div class="grid lg:grid-cols-5 gap-6">

                <!-- Input Form (Left - 2 columns) -->
                <div class="lg:col-span-2">
                    <div class="glass-card rounded-2xl shadow-2xl p-6 sticky top-24 space-y-5">
                        <div class="border-b border-gray-200 dark:border-gray-700 pb-4">
                            <h2
                                class="text-2xl font-bold font-display text-gray-900 dark:text-white flex items-center gap-2">
                                <span class="material-symbols-outlined text-primary">edit_note</span>
                                Your Details
                            </h2>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">Fill in your information to
                                generate a professional SOP</p>
                        </div>

                        <form id="sopForm" class="space-y-4">

                            <!-- Personal Details -->
                            <div>
                                <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">
                                    <span class="material-symbols-outlined text-xs align-middle">person</span>
                                    Your Full Name *
                                </label>
                                <input type="text" id="studentName" required
                                    class="w-full px-4 py-3 bg-white dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-primary focus:border-primary transition-all"
                                    placeholder="e.g., John Doe">
                            </div>

                            <div>
                                <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">
                                    <span class="material-symbols-outlined text-xs align-middle">school</span>
                                    Target University *
                                </label>
                                <input type="text" id="university" required
                                    class="w-full px-4 py-3 bg-white dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-primary focus:border-primary transition-all"
                                    placeholder="e.g., Stanford University">
                            </div>

                            <div>
                                <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">
                                    <span class="material-symbols-outlined text-xs align-middle">science</span>
                                    Field of Study *
                                </label>
                                <input type="text" id="fieldOfStudy" required
                                    class="w-full px-4 py-3 bg-white dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-primary focus:border-primary transition-all"
                                    placeholder="e.g., Artificial Intelligence, Robotics, Data Science">
                            </div>

                            <div>
                                <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">
                                    <span class="material-symbols-outlined text-xs align-middle">military_tech</span>
                                    Current Degree
                                </label>
                                <input type="text" id="currentDegree"
                                    class="w-full px-4 py-3 bg-white dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-primary transition-all"
                                    placeholder="e.g., B.Tech in Computer Science">
                            </div>

                            <div>
                                <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">
                                    <span class="material-symbols-outlined text-xs align-middle">domain</span>
                                    Current University
                                </label>
                                <input type="text" id="currentUniversity"
                                    class="w-full px-4 py-3 bg-white dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-primary transition-all"
                                    placeholder="e.g., XYZ University">
                            </div>

                            <div>
                                <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">
                                    <span class="material-symbols-outlined text-xs align-middle">lab_research</span>
                                    Research Interests (Optional)
                                </label>
                                <textarea id="researchInterests" rows="3"
                                    class="w-full px-4 py-3 bg-white dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-primary resize-none transition-all"
                                    placeholder="e.g., Deep Learning, Computer Vision, Natural Language Processing"></textarea>
                            </div>

                            <div>
                                <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">
                                    <span class="material-symbols-outlined text-xs align-middle">emoji_events</span>
                                    Key Achievements (Optional)
                                </label>
                                <textarea id="achievements" rows="3"
                                    class="w-full px-4 py-3 bg-white dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-primary resize-none transition-all"
                                    placeholder="e.g., Published research papers, top grades (GPA 3.9/4.0), won hackathons"></textarea>
                            </div>

                            <div>
                                <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">
                                    <span class="material-symbols-outlined text-xs align-middle">target</span>
                                    Career Goals (Optional)
                                </label>
                                <textarea id="careerGoals" rows="3"
                                    class="w-full px-4 py-3 bg-white dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-primary resize-none transition-all"
                                    placeholder="e.g., Lead AI research at top tech companies, contribute to open-source AI"></textarea>
                            </div>

                            <!-- Submit Button -->
                            <button type="submit"
                                class="w-full bg-gradient-to-r from-primary to-secondary hover:shadow-2xl text-white font-bold py-4 px-6 rounded-xl transition-all transform hover:scale-[1.02] flex items-center justify-center gap-3">
                                <span class="material-symbols-outlined text-2xl">auto_awesome</span>
                                <span>Generate SOP with AI Analysis</span>
                            </button>

                            <!-- Info Box -->
                            <div
                                class="p-4 bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-xl border-2 border-blue-200 dark:border-blue-800">
                                <p class="text-xs text-gray-700 dark:text-gray-300 leading-relaxed">
                                    <strong class="text-primary dark:text-secondary">‚ú® AI-Powered Analysis:</strong>
                                    Get a professional SOP following the 8-section format with detailed scoring,
                                    strengths analysis, and specific improvement suggestions!
                                </p>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- SOP Preview & Analysis (Right - 3 columns) -->
                <div class="lg:col-span-3">

                    <!-- Empty State -->
                    <div id="emptyState" class="glass-card rounded-2xl shadow-2xl p-16 text-center">
                        <div class="mb-8 animate-bounce">
                            <span class="text-8xl">üìù</span>
                        </div>
                        <h3 class="text-3xl font-bold font-display text-gray-900 dark:text-white mb-4">
                            Ready to Create Your SOP?
                        </h3>
                        <p class="text-lg text-gray-600 dark:text-gray-400 mb-6 max-w-lg mx-auto leading-relaxed">
                            Fill in your details in the form and click <strong>Generate SOP</strong> to create a
                            professional Statement of Purpose with AI-powered analysis!
                        </p>
                        <div class="grid grid-cols-3 gap-4 mt-8 max-w-2xl mx-auto">
                            <div class="p-4 bg-green-50 dark:bg-green-900/20 rounded-lg">
                                <div class="text-3xl mb-2">üìã</div>
                                <div class="text-sm font-semibold">8 Sections</div>
                            </div>
                            <div class="p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                                <div class="text-3xl mb-2">ü§ñ</div>
                                <div class="text-sm font-semibold">AI Analysis</div>
                            </div>
                            <div class="p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg">
                                <div class="text-3xl mb-2">üí°</div>
                                <div class="text-sm font-semibold">Improvements</div>
                            </div>
                        </div>
                    </div>

                    <!-- SOP Container (Hidden initially) -->
                    <div id="sopContainer" class="hidden space-y-6">

                        <!-- Action Buttons -->
                        <div class="glass-card rounded-2xl shadow-xl p-5 flex flex-wrap items-center gap-3">
                            <button onclick="downloadSOP()"
                                class="px-5 py-2.5 bg-primary hover:bg-primary/90 text-white rounded-xl font-semibold flex items-center gap-2 transition-all transform hover:scale-105">
                                <span class="material-symbols-outlined">download</span>
                                Download SOP
                            </button>
                            <button onclick="copySOP()"
                                class="px-5 py-2.5 bg-secondary hover:bg-secondary/90 text-white rounded-xl font-semibold flex items-center gap-2 transition-all transform hover:scale-105">
                                <span class="material-symbols-outlined">content_copy</span>
                                Copy Text
                            </button>
                            <button onclick="toggleAnalysis()" id="analysisToggle"
                                class="px-5 py-2.5 border-2 border-primary text-primary hover:bg-primary/10 rounded-xl font-semibold flex items-center gap-2 transition-all">
                                <span class="material-symbols-outlined">analytics</span>
                                View AI Analysis
                            </button>
                            <button onclick="closeSOP()"
                                class="ml-auto px-5 py-2.5 border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-xl font-semibold transition-all">
                                <span class="material-symbols-outlined">close</span>
                            </button>
                        </div>

                        <!-- SOP Content -->
                        <div class="glass-card rounded-2xl shadow-2xl p-2">
                            <div id="sopContent" class="sop-preview"></div>
                        </div>

                        <!-- AI Analysis Section (Hidden initially) -->
                        <div id="analysisSection" class="hidden glass-card rounded-2xl shadow-2xl p-8 space-y-8">
                            <div class="border-b border-gray-200 dark:border-gray-700 pb-4">
                                <h3 class="text-3xl font-bold font-display flex items-center gap-3">
                                    <span class="material-symbols-outlined text-4xl text-primary">analytics</span>
                                    AI Analysis & Improvement Suggestions
                                </h3>
                                <p class="text-gray-600 dark:text-gray-400 mt-2">Detailed feedback on your Statement of
                                    Purpose</p>
                            </div>

                            <div id="analysisContent"></div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <!-- Footer -->
    <div id="footer-placeholder"></div>

    <!-- Scripts -->
    <script src="assets/js/components-loader.js"></script>
    <script src="assets/js/auth.js"></script>
    <script src="assets/js/theme-toggle.js"></script>
    <script src="assets/js/ai-api.js"></script>

    <script>
        let generatedSOP = '';
        let sopAnalysis = null;

        // Form submission handler
        document.getElementById('sopForm').addEventListener('submit', generateSOP);

        async function generateSOP(e) {
            e.preventDefault();

            // Check if user is logged in
            const isLoggedIn = localStorage.getItem('accessToken') ||
                localStorage.getItem('auth_token') ||
                localStorage.getItem('userEmail');

            if (!isLoggedIn) {
                alert('‚ö†Ô∏è Please login to use the SOP Generator');
                setTimeout(() => {
                    window.location.href = 'login.html?redirect=' + encodeURIComponent(window.location.pathname);
                }, 2000);
                return;
            }

            // Collect form data
            const formData = {
                name: document.getElementById('studentName').value.trim(),
                university: document.getElementById('university').value.trim(),
                field: document.getElementById('fieldOfStudy').value.trim(),
                currentDegree: document.getElementById('currentDegree').value.trim(),
                currentUniversity: document.getElementById('currentUniversity').value.trim(),
                researchInterests: document.getElementById('researchInterests').value.trim(),
                achievements: document.getElementById('achievements').value.trim(),
                careerGoals: document.getElementById('careerGoals').value.trim()
            };

            // Show loading state
            const submitBtn = document.querySelector('#sopForm button[type="submit"]');
            const originalBtnHtml = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="animate-spin material-symbols-outlined">progress_activity</span> Generating & Humanizing...';

            try {
                // 1. Generate initial SOP content
                const initialSopFormatted = generateSOPContent(formData);
                const initialSopText = initialSopFormatted.replace(/<[^>]*>/g, ' ');

                // 2. Automatically Humanize
                const humanizationResult = await AI_API.humanizeSOP(initialSopText);

                let sopToAnalyze = initialSopText;
                if (humanizationResult.success && humanizationResult.humanizedText) {
                    generatedSOP = wrapInStructure(humanizationResult.humanizedText);
                    sopToAnalyze = humanizationResult.humanizedText;
                } else {
                    generatedSOP = initialSopFormatted;
                }

                // 3. Analyze the Humanized SOP
                const backendAnalysis = await AI_API.analyzeSOP(sopToAnalyze);
                const formatted = AI_API.formatSOPResult(backendAnalysis);

                sopAnalysis = {
                    score: formatted.score,
                    humanizeScore: formatted.humanizeScore,
                    humanizeFeedback: formatted.humanizeFeedback || 'SOP has been automatically humanized for better authenticity.',
                    wordCount: formatted.actionableSummary.match(/\d+/)?.[0] || sopToAnalyze.split(/\s+/).length,
                    recommendedWordCount: '800-1000 words',
                    strengths: Object.keys(formatted.categories || {}).map(k => `‚úÖ Strong ${k} content`),
                    improvements: formatted.weakAreas.map(w => `üí° ${w}`),
                    sections: Object.entries(formatted.categories || {}).reduce((acc, [key, val]) => {
                        acc[key] = {
                            score: val,
                            feedback: `Analysis of ${key} section.`
                        };
                        return acc;
                    }, {})
                };

                // Display results
                displaySOP(generatedSOP);
                scrollToResults();
                showNotification('‚ú® SOP generated and humanized successfully!');

            } catch (err) {
                console.error('SOP Processing failed:', err);
                showNotification('‚ùå Failed to generate SOP. Using backup generator...');

                // Fallback process
                const fallbackSop = generateSOPContent(formData);
                generatedSOP = fallbackSop;
                sopAnalysis = analyzeSOP(fallbackSop, formData);
                displaySOP(fallbackSop);
                scrollToResults();
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalBtnHtml;
            }
        }



        function wrapInStructure(text) {
            // Simple wrapper to maintain formatting if the AI returns raw text
            const today = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
            const name = document.getElementById('studentName').value;

            return `
<div class="sop-document">
    <div class="text-center mb-10 pb-6 border-b-2 border-gray-200 dark:border-gray-700">
        <h1 class="text-4xl font-bold mb-4 text-gray-900 dark:text-white">Statement of Purpose</h1>
        <p class="text-gray-600 dark:text-gray-400"><strong>Name:</strong> ${name}</p>
        <p class="text-gray-600 dark:text-gray-400"><strong>Date:</strong> ${today}</p>
    </div>
    <div class="whitespace-pre-wrap text-justify leading-relaxed">
        ${text}
    </div>
</div>
             `.trim();
        }

        function getHumanizeColor(score) {
            if (score >= 90) return 'text-green-600';
            if (score >= 75) return 'text-blue-600';
            if (score >= 60) return 'text-yellow-600';
            return 'text-red-600';
        }

        function generateSOPContent(data) {
            const today = new Date().toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            const universityName = data.university.split(' ')[0]; // e.g., "Stanford" from "Stanford University"

            return `
<div class="sop-document">
    <div class="text-center mb-10 pb-6 border-b-2 border-gray-200 dark:border-gray-700">
        <h1 class="text-4xl font-bold mb-4 text-gray-900 dark:text-white">Statement of Purpose</h1>
        <p class="text-gray-600 dark:text-gray-400"><strong>Name:</strong> ${data.name}</p>
        <p class="text-gray-600 dark:text-gray-400"><strong>Date:</strong> ${today}</p>
    </div>

    <h2 class="sop-section-title">1. Professional Silhouette</h2>
    <p class="mb-5 text-justify">
        From a young age, I have been captivated by the intricate dance of systems and the elegance of problem-solving. 
        This fascination, initially sparked by disassembling and reassembling discarded electronics, evolved into a profound 
        commitment to ${data.field}. My undergraduate journey in ${data.currentDegree || 'engineering'} has solidified this passion, 
        revealing a deep-seated desire to not just understand the existing technological landscape but to actively shape its future. 
        I am ${data.name}, and I am writing to express my fervent interest in pursuing a Master's program at ${data.university}, 
        an institution synonymous with innovation and a breeding ground for transformative ideas. My ambition is to contribute 
        meaningfully to the advancement of ${data.field}, and I believe that ${data.university}'s unparalleled resources and 
        faculty provide the ideal environment for me to achieve this goal.
    </p>

    <h2 class="sop-section-title">2. Academic Foundation</h2>
    <p class="mb-5 text-justify">
        My undergraduate experience at ${data.currentUniversity || 'my university'} provided a solid foundation in the core 
        principles of ${data.field}. The curriculum, while rigorous, instilled in me a deep appreciation for theoretical knowledge 
        and practical applications. ${data.achievements ? 'My academic journey has been marked by significant achievements: ' + data.achievements + '.' : 'I have consistently demonstrated strong academic performance throughout my studies.'} 
        These experiences not only equipped me with theoretical knowledge but also honed my analytical and problem-solving skills. 
        ${data.currentDegree ? 'During my ' + data.currentDegree + ' program, I' : 'I'} particularly thrived in courses that 
        challenged me to think critically and apply concepts to real-world problems. This hands-on experience has prepared me 
        well for the rigors of graduate-level research and study.
    </p>

    <h2 class="sop-section-title">3. Intellectual Passion</h2>
    <p class="mb-5 text-justify">
        My interest in pursuing a Master's degree stems from a conviction that ${data.field} is poised to revolutionize multiple 
        industries and sectors. ${data.researchInterests ? 'I am particularly interested in exploring: ' + data.researchInterests + '. ' : ''}
        The convergence of advanced technologies is creating unprecedented opportunities to develop intelligent systems that can 
        improve lives, solve complex challenges, and push the boundaries of what we thought possible. For example, the application 
        of these technologies in areas such as healthcare, transportation, and environmental sustainability promises to create 
        transformative solutions. I am eager to contribute to this exciting field and be part of the generation that shapes the 
        future of ${data.field}. My passion extends beyond mere technical proficiency; I am driven by the potential to create 
        meaningful impact through innovation and research.
    </p>

    <h2 class="sop-section-title">4. Why ${universityName}?</h2>
    <p class="mb-5 text-justify">
        ${data.university} stands out as the preeminent institution for pursuing my Master's degree due to its unparalleled 
        reputation for academic excellence, cutting-edge research facilities, and distinguished faculty. The department at 
        ${data.university} is at the forefront of research in ${data.field}, with faculty members conducting groundbreaking 
        research that is shaping the future of the discipline. The opportunity to learn from and collaborate with these leading 
        experts is incredibly appealing and aligns perfectly with my academic and professional goals. Furthermore, ${universityName}'s 
        emphasis on interdisciplinary collaboration and its strong ties with industry leaders provide a unique environment for 
        innovation and entrepreneurship. The state-of-the-art facilities, comprehensive curriculum, and vibrant research community 
        make ${data.university} the ideal place for me to pursue my graduate studies and develop into a leader in ${data.field}.
    </p>

    <h2 class="sop-section-title">5. Global Perspective: Why USA?</h2>
    <p class="mb-5 text-justify">
        The United States offers an unparalleled ecosystem for advanced studies and career opportunities in ${data.field}. 
        The country's strong commitment to research and development, its vibrant technology industry, and its diverse and 
        welcoming culture make it an ideal destination for international students. The US boasts a concentration of world-renowned 
        universities, research institutions, and technology companies, creating a dynamic environment for innovation and collaboration. 
        Furthermore, the US offers a wide range of post-study work opportunities, allowing graduates to gain valuable industry 
        experience and contribute to cutting-edge projects. The quality of life, cultural diversity, and the opportunity to 
        collaborate with brilliant minds from around the world are additional factors that strengthen my conviction to pursue 
        my Master's degree in the United States. I am confident that studying in the US would provide me with the intellectual 
        stimulation, professional opportunities, and personal growth that I am seeking.
    </p>

    <h2 class="sop-section-title">6. The Road Not Taken</h2>
    <p class="mb-5 text-justify">
        While my home country's technological landscape is rapidly evolving, pursuing a Master's degree at ${data.university} 
        would provide me with specialized knowledge and global exposure that is currently unmatched elsewhere. The depth and 
        breadth of research opportunities, access to cutting-edge technologies, and the global network of alumni and faculty 
        offered by ${data.university} are unique advantages. Although excellent institutions exist in my home country, the 
        specific focus, advanced coursework, and international research collaborations available at ${universityName} align 
        more closely with my research interests and career aspirations. The opportunity to collaborate with leading researchers 
        from around the world and gain exposure to diverse perspectives is crucial for my intellectual and professional development. 
        I believe that studying at ${data.university} would provide me with the unique skills, global perspective, and professional 
        network necessary to become a leader in the field of ${data.field} and contribute meaningfully to the global community.
    </p>

    <h2 class="sop-section-title">7. Future Horizons</h2>
    <p class="mb-5 text-justify">
        My long-term career goal is to become a leading researcher and innovator in the field of ${data.field}. 
        ${data.careerGoals ? 'Specifically, I envision: ' + data.careerGoals + '. ' : 'In the next 5-10 years, I envision myself working in a research and development role at a leading technology company or research institution, contributing to breakthrough innovations that have real-world impact. '}
        My Master's degree from ${data.university} would provide me with the technical skills, research experience, and 
        professional network necessary to achieve these goals. I aspire to lead innovative research projects, mentor the next 
        generation of researchers, and contribute to solutions that address some of the world's most pressing challenges. 
        I also hope to contribute to the academic community by publishing research findings in leading journals and presenting 
        at international conferences. Ultimately, I want to use my skills and knowledge to make a positive impact on society 
        and contribute to a more sustainable, equitable, and technologically advanced future.
    </p>

    <h2 class="sop-section-title">8. Closing Statement</h2>
    <p class="mb-5 text-justify">
        I am confident that my academic background, research experience, and unwavering passion for ${data.field} make me a 
        strong candidate for the Master's program at ${data.university}. I am eager to contribute to the vibrant research 
        community at ${universityName} and learn from world-renowned faculty who are pioneers in their fields. I am certain 
        that this program would provide me with the knowledge, skills, and network necessary to achieve my career goals and 
        make a meaningful contribution to ${data.field}. I am highly motivated, dedicated, and eager to embark on this 
        challenging and rewarding journey. I look forward to the opportunity to grow both academically and personally at 
        ${data.university}, and I am committed to making the most of every learning opportunity. Thank you for considering 
        my application. I am excited about the prospect of joining the ${universityName} community and contributing to its 
        legacy of excellence and innovation.
    </p>
</div>
            `.trim();
        }

        function analyzeSOP(sop, data) {
            // Calculate metrics
            const wordCount = sop.replace(/<[^>]*>/g, '').split(/\s+/).filter(w => w.length > 0).length;
            const hasResearch = data.researchInterests && data.researchInterests.length > 20;
            const hasAchievements = data.achievements && data.achievements.length > 20;
            const hasCareerGoals = data.careerGoals && data.careerGoals.length > 20;
            const hasDegreeInfo = data.currentDegree && data.currentUniversity;

            // Calculate base score
            let baseScore = 75;
            if (hasResearch) baseScore += 5;
            if (hasAchievements) baseScore += 5;
            if (hasCareerGoals) baseScore += 5;
            if (hasDegreeInfo) baseScore += 5;
            if (wordCount >= 800 && wordCount <= 1200) baseScore += 5;

            return {
                score: baseScore,
                wordCount: wordCount,
                recommendedWordCount: '800-1000 words',
                strengths: [
                    '‚úÖ Clear 8-section structure following standard SOP format',
                    '‚úÖ Strong opening that captures attention and establishes motivation',
                    '‚úÖ Well-articulated connection between past experience and future goals',
                    '‚úÖ Good balance of personal narrative and professional aspirations',
                    hasAchievements ? '‚úÖ Specific achievements mentioned to support credentials' : null,
                    hasResearch ? '‚úÖ Clear research interests demonstrate focus and direction' : null,
                    hasCareerGoals ? '‚úÖ Concrete career goals show long-term vision' : null,
                    '‚úÖ Professional tone maintained throughout'
                ].filter(Boolean),
                improvements: [
                    !hasAchievements ? 'üí° Add specific achievements with quantifiable results (e.g., "improved performance by 30%", "GPA 3.9/4.0")' : null,
                    !hasResearch ? 'üí° Include specific research interests or sub-areas you want to explore' : null,
                    !hasCareerGoals ? 'üí° Add more detailed career goals with specific timeline and roles' : null,
                    'üí° Mention specific professors whose work aligns with your interests',
                    'üí° Reference specific labs, centers, or courses at the target university',
                    'üí° Add concrete examples of projects or research you\'ve conducted',
                    'üí° Include quantifiable metrics from your undergraduate work',
                    !hasDegreeInfo ? 'üí° Provide complete current degree and university information' : null,
                    wordCount < 800 ? 'üí° Expand your SOP - aim for 800-1000 words for comprehensive coverage' : null,
                    wordCount > 1200 ? 'üí° Consider condensing - SOPs over 1200 words may lose reader attention' : null
                ].filter(Boolean),
                sections: {
                    professionalSilhouette: {
                        score: 92,
                        feedback: 'Excellent opening with strong narrative hook and clear motivation'
                    },
                    academicFoundation: {
                        score: hasAchievements && hasDegreeInfo ? 88 : 75,
                        feedback: hasAchievements ? 'Strong academic background presented with specific examples' : 'Good foundation, but add more specific course examples and quantifiable achievements'
                    },
                    intellectualPassion: {
                        score: hasResearch ? 90 : 78,
                        feedback: hasResearch ? 'Clear passion with well-defined research interests' : 'Good motivation shown, but be more specific about research sub-areas you want to explore'
                    },
                    whyUniversity: {
                        score: 72,
                        feedback: 'Generic university praise - strengthen by mentioning specific professors, labs, or courses'
                    },
                    globalPerspective: {
                        score: 85,
                        feedback: 'Well-articulated reasons for choosing USA with good cultural awareness'
                    },
                    roadNotTaken: {
                        score: 82,
                        feedback: 'Good comparative analysis, shows maturity in decision-making'
                    },
                    futureHorizons: {
                        score: hasCareerGoals ? 90 : 80,
                        feedback: hasCareerGoals ? 'Clear and ambitious career goals with specific direction' : 'Good vision, but add more specific timeline and concrete roles you aim for'
                    },
                    closingStatement: {
                        score: 93,
                        feedback: 'Strong, confident conclusion that reinforces candidacy'
                    }
                }
            };
        }

        function displaySOP(sop) {
            document.getElementById('emptyState').classList.add('hidden');
            document.getElementById('sopContainer').classList.remove('hidden');
            document.getElementById('sopContent').innerHTML = sop;

            // Generate and display analysis
            displayAnalysis();
        }

        function displayAnalysis() {
            const content = document.getElementById('analysisContent');
            const analysis = sopAnalysis;

            // Determine score color
            let scoreColor = 'text-yellow-600';
            if (analysis.score >= 90) scoreColor = 'text-green-600';
            else if (analysis.score >= 80) scoreColor = 'text-blue-600';
            else if (analysis.score < 75) scoreColor = 'text-red-600';

            content.innerHTML = `
                <div class="space-y-8">
                    
                    <!-- Overall Score -->
                    <div class="analysis-card bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 p-8 rounded-2xl border-2 border-primary/30">
                        <div class="flex items-center justify-between">
                            <div>
                                <h4 class="text-xl font-bold text-gray-800 dark:text-gray-200 mb-2">Overall SOP Score</h4>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Based on structure, content, and completeness</p>
                            </div>
                            <div class="text-right">
                                <div class="text-6xl font-bold ${scoreColor}">${analysis.score}</div>
                                <div class="text-2xl font-semibold text-gray-500">/100</div>
                            </div>
                        </div>
                        <div class="mt-4 bg-gray-200 dark:bg-gray-700 rounded-full h-3">
                            <div class="bg-gradient-to-r from-primary to-secondary h-3 rounded-full transition-all" 
                                style="width: ${analysis.score}%"></div>
                        </div>
                    </div>

                    <!-- Humanize Score -->
                    <div id="humanizeScoreContainer" class="analysis-card bg-gradient-to-r from-indigo-50 to-blue-50 dark:from-indigo-900/20 dark:to-blue-900/20 p-8 rounded-2xl border-2 border-blue-400/30">
                        <div class="flex items-center justify-between">
                            <div>
                                <h4 class="text-xl font-bold text-gray-800 dark:text-gray-200 mb-2">Humanize Score</h4>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Higher score indicates more authentic, human-like writing</p>
                            </div>
                            <div class="text-right">
                                <div class="text-6xl font-bold ${getHumanizeColor(analysis.humanizeScore)}">${analysis.humanizeScore}</div>
                                <div class="text-2xl font-semibold text-gray-500">/100</div>
                            </div>
                        </div>
                        <div class="mt-4 bg-gray-200 dark:bg-gray-700 rounded-full h-3">
                            <div class="bg-gradient-to-r from-blue-500 to-indigo-600 h-3 rounded-full transition-all" 
                                style="width: ${analysis.humanizeScore}%"></div>
                        </div>
                        <div class="mt-6 p-4 bg-white/50 dark:bg-black/20 rounded-xl border border-blue-200 dark:border-blue-800">
                             <p class="text-sm italic text-gray-700 dark:text-gray-300">
                                <span class="material-symbols-outlined align-middle text-blue-600 mr-1">info</span>
                                ${analysis.humanizeFeedback}
                             </p>
                        </div>
                    </div>

                    <!-- Strengths -->
                    <div class="analysis-card bg-green-50 dark:bg-green-900/20 p-8 rounded-2xl border-2 border-green-200 dark:border-green-800">
                        <h4 class="text-2xl font-bold mb-5 flex items-center gap-3 text-gray-800 dark:text-gray-200">
                            <span class="material-symbols-outlined text-3xl text-green-600">verified</span>
                            Strengths of Your SOP
                        </h4>
                        <div class="space-y-3">
                            ${analysis.strengths.map(strength => `
                                <div class="strength-item flex items-start gap-3 shadow-md">
                                    <span class="material-symbols-outlined text-2xl flex-shrink-0">check_circle</span>
                                    <span class="leading-relaxed">${strength}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Improvements -->
                    <div class="analysis-card bg-amber-50 dark:bg-amber-900/20 p-8 rounded-2xl border-2 border-amber-200 dark:border-amber-800">
                        <h4 class="text-2xl font-bold mb-5 flex items-center gap-3 text-gray-800 dark:text-gray-200">
                            <span class="material-symbols-outlined text-3xl text-amber-600">tips_and_updates</span>
                            Suggested Improvements
                        </h4>
                        <div class="space-y-3">
                            ${analysis.improvements.map(improvement => `
                                <div class="improvement-item flex items-start gap-3 shadow-md">
                                    <span class="material-symbols-outlined text-2xl flex-shrink-0">lightbulb</span>
                                    <span class="leading-relaxed">${improvement}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Section-by-Section Breakdown -->
                    <div class="analysis-card bg-purple-50 dark:bg-purple-900/20 p-8 rounded-2xl border-2 border-purple-200 dark:border-purple-800">
                        <h4 class="text-2xl font-bold mb-6 flex items-center gap-3 text-gray-800 dark:text-gray-200">
                            <span class="material-symbols-outlined text-3xl text-purple-600">assessment</span>
                            Section-by-Section Analysis
                        </h4>
                        <div class="space-y-5">
                            ${Object.entries(analysis.sections).map(([key, value], index) => `
                                <div class="bg-white dark:bg-gray-800 p-5 rounded-xl border-l-4 border-primary shadow-sm">
                                    <div class="flex justify-between items-start mb-2">
                                        <span class="font-bold text-lg text-gray-800 dark:text-gray-200">
                                            ${index + 1}. ${key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase())}
                                        </span>
                                        <span class="section-score">${value.score}/100</span>
                                    </div>
                                    <p class="text-sm text-gray-600 dark:text-gray-400 leading-relaxed">${value.feedback}</p>
                                    <div class="mt-3 bg-gray-100 dark:bg-gray-700 rounded-full h-2">
                                        <div class="bg-primary h-2 rounded-full transition-all" style="width: ${value.score}%"></div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Word Count Stats -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-gradient-to-br from-indigo-50 to-indigo-100 dark:from-indigo-900/20 dark:to-indigo-900/30 p-6 rounded-xl border-2 border-indigo-200 dark:border-indigo-800 text-center">
                            <div class="text-sm font-semibold text-gray-600 dark:text-gray-400 mb-2">Current Word Count</div>
                            <div class="text-4xl font-bold text-indigo-600">${analysis.wordCount}</div>
                        </div>
                        <div class="bg-gradient-to-br from-teal-50 to-teal-100 dark:from-teal-900/20 dark:to-teal-900/30 p-6 rounded-xl border-2 border-teal-200 dark:border-teal-800 text-center">
                            <div class="text-sm font-semibold text-gray-600 dark:text-gray-400 mb-2">Recommended Range</div>
                            <div class="text-3xl font-bold text-teal-600">${analysis.recommendedWordCount}</div>
                        </div>
                        <div class="bg-gradient-to-br from-rose-50 to-rose-100 dark:from-rose-900/20 dark:to-rose-900/30 p-6 rounded-xl border-2 border-rose-200 dark:border-rose-800 text-center">
                            <div class="text-sm font-semibold text-gray-600 dark:text-gray-400 mb-2">  Status</div>
                            <div class="text-2xl font-bold text-rose-600">
                                ${analysis.wordCount >= 800 && analysis.wordCount <= 1000 ? '‚úÖ Perfect' :
                    analysis.wordCount < 800 ? '‚ö†Ô∏è Too Short' : '‚ö†Ô∏è Too Long'}
                            </div>
                        </div>
                    </div>

                    <!-- Action Recommendations -->
                    <div class="bg-gradient-to-r from-primary/10 to-secondary/10 p-8 rounded-2xl border-2 border-primary/20">
                        <h4 class="text-xl font-bold mb-4 text-gray-800 dark:text-gray-200">üìå Next Steps</h4>
                        <ul class="space-y-3 text-gray-700 dark:text-gray-300">
                            <li class="flex items-start gap-3">
                                <span class="text-primary font-bold">1.</span>
                                <span>Review the improvement suggestions and update your SOP with specific examples</span>
                            </li>
                            <li class="flex items-start gap-3">
                                <span class="text-primary font-bold">2.</span>
                                <span>Research the target university's faculty and mention specific professors or labs</span>
                            </li>
                            <li class="flex items-start gap-3">
                                <span class="text-primary font-bold">3.</span>
                                <span>Add quantifiable achievements and concrete project examples</span>
                            </li>
                            <li class="flex items-start gap-3">
                                <span class="text-primary font-bold">4.</span>
                                <span>Proofread for grammar, clarity, and ensure word count is within recommended range</span>
                            </li>
                            <li class="flex items-start gap-3">
                                <span class="text-primary font-bold">5.</span>
                                <span>Get feedback from mentors or professors before final submission</span>
                            </li>
                        </ul>
                    </div>
                </div>
            `;
        }

        function toggleAnalysis() {
            const section = document.getElementById('analysisSection');
            const button = document.getElementById('analysisToggle');

            section.classList.toggle('hidden');

            if (section.classList.contains('hidden')) {
                button.innerHTML = '<span class="material-symbols-outlined">analytics</span> View AI Analysis';
            } else {
                button.innerHTML = '<span class="material-symbols-outlined">visibility_off</span> Hide Analysis';
                // Scroll to analysis
                section.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        function downloadSOP() {
            // Remove HTML tags for plain text
            const plainText = generatedSOP.replace(/<[^>]*>/g, '').replace(/\s+/g, ' ').trim();

            const element = document.createElement('a');
            const file = new Blob([plainText], { type: 'text/plain' });
            element.href = URL.createObjectURL(file);
            element.download = 'Statement_of_Purpose.txt';
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);

            // Success notification
            showNotification('‚úÖ SOP downloaded successfully!');
        }

        function copySOP() {
            const plainText = generatedSOP.replace(/<[^>]*>/g, '').replace(/\s+/g, ' ').trim();

            navigator.clipboard.writeText(plainText).then(() => {
                showNotification('‚úÖ SOP copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy:', err);
                showNotification('‚ùå Failed to copy. Please try again.');
            });
        }

        function closeSOP() {
            document.getElementById('emptyState').classList.remove('hidden');
            document.getElementById('sopContainer').classList.add('hidden');
            document.getElementById('analysisSection').classList.add('hidden');

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function scrollToResults() {
            setTimeout(() => {
                document.getElementById('sopContainer').scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }, 300);
        }

        function showNotification(message) {
            // Simple notification (you can enhance this with a toast library)
            const notification = document.createElement('div');
            notification.className = 'fixed top-24 right-6 bg-primary text-white px-6 py-4 rounded-xl shadow-2xl z-50 transform transition-all';
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 3000);
        }
    </script>
</body>

</html>