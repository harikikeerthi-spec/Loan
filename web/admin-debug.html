<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard Debug</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .debug-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }

        .success {
            background: #d4edda;
            color: #155724;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
        }

        .warning {
            background: #fff3cd;
            color: #856404;
        }

        button {
            background: #6605c7;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }

        button:hover {
            background: #5004a0;
        }

        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>

<body>
    <h1>üîç Admin Dashboard Debugger</h1>

    <div class="debug-section">
        <h2>1. Authentication Check</h2>
        <div id="authStatus"></div>
        <button onclick="checkAuth()">Check Authentication</button>
        <button onclick="setDemoToken()">Set Demo Admin Token</button>
    </div>

    <div class="debug-section">
        <h2>2. API Connection Test</h2>
        <div id="apiStatus"></div>
        <button onclick="testAPI()">Test API Connection</button>
    </div>

    <div class="debug-section">
        <h2>3. Blog Data Test</h2>
        <div id="blogStatus"></div>
        <button onclick="testBlogs()">Test Blog API</button>
    </div>

    <div class="debug-section">
        <h2>4. Community Data Test</h2>
        <div id="communityStatus"></div>
        <button onclick="testCommunity()">Test Community API</button>
    </div>

    <div class="debug-section">
        <h2>5. Console Logs</h2>
        <pre id="logs"></pre>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:3000';
        let logs = [];

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            logs.push(`[${timestamp}] ${type.toUpperCase()}: ${message}`);
            document.getElementById('logs').textContent = logs.join('\n');
            console.log(message);
        }

        function checkAuth() {
            const authStatus = document.getElementById('authStatus');
            const adminToken = localStorage.getItem('adminToken');
            const userEmail = localStorage.getItem('userEmail');
            const accessToken = localStorage.getItem('accessToken');

            let html = '';

            if (adminToken) {
                html += `<div class="status success">‚úÖ Admin Token Found</div>`;
                html += `<pre>Token: ${adminToken.substring(0, 20)}...</pre>`;
                log('Admin token found', 'success');
            } else {
                html += `<div class="status error">‚ùå Admin Token NOT Found</div>`;
                log('Admin token not found', 'error');
            }

            if (userEmail) {
                html += `<div class="status success">‚úÖ User Email: ${userEmail}</div>`;
            } else {
                html += `<div class="status warning">‚ö†Ô∏è User Email NOT Found</div>`;
            }

            if (accessToken) {
                html += `<div class="status success">‚úÖ Access Token Found</div>`;
                html += `<pre>Token: ${accessToken.substring(0, 20)}...</pre>`;
            }

            authStatus.innerHTML = html;
        }

        function setDemoToken() {
            // Set a demo token for testing
            localStorage.setItem('adminToken', 'demo-admin-token-12345');
            localStorage.setItem('userEmail', 'admin@test.com');
            log('Demo token set', 'success');
            alert('Demo admin token set! Now try checking authentication.');
        }

        async function testAPI() {
            const apiStatus = document.getElementById('apiStatus');
            apiStatus.innerHTML = '<div class="status warning">‚è≥ Testing API connection...</div>';
            log('Testing API connection...');

            try {
                const response = await fetch(`${API_BASE_URL}/blogs`);
                log(`API Response Status: ${response.status}`);

                if (response.ok) {
                    const data = await response.json();
                    apiStatus.innerHTML = `
                        <div class="status success">‚úÖ API Connected Successfully!</div>
                        <pre>${JSON.stringify(data, null, 2).substring(0, 500)}...</pre>
                    `;
                    log('API connection successful', 'success');
                } else {
                    apiStatus.innerHTML = `<div class="status error">‚ùå API Error: ${response.status} ${response.statusText}</div>`;
                    log(`API error: ${response.status}`, 'error');
                }
            } catch (error) {
                apiStatus.innerHTML = `<div class="status error">‚ùå API Connection Failed: ${error.message}</div>`;
                log(`API connection failed: ${error.message}`, 'error');
            }
        }

        async function testBlogs() {
            const blogStatus = document.getElementById('blogStatus');
            blogStatus.innerHTML = '<div class="status warning">‚è≥ Fetching blogs...</div>';
            log('Fetching blogs...');

            const adminToken = localStorage.getItem('adminToken');

            try {
                // Test public endpoint first
                const publicResponse = await fetch(`${API_BASE_URL}/blogs`);
                log(`Public blogs endpoint status: ${publicResponse.status}`);

                if (publicResponse.ok) {
                    const publicData = await publicResponse.json();
                    blogStatus.innerHTML = `
                        <div class="status success">‚úÖ Public Blogs API Working!</div>
                        <p>Found ${publicData.data?.length || 0} blogs</p>
                        <pre>${JSON.stringify(publicData, null, 2).substring(0, 500)}...</pre>
                    `;
                    log(`Found ${publicData.data?.length || 0} public blogs`, 'success');
                }

                // Test admin endpoint
                if (adminToken) {
                    const adminResponse = await fetch(`${API_BASE_URL}/blogs/admin/all`, {
                        headers: {
                            'Authorization': `Bearer ${adminToken}`
                        }
                    });
                    log(`Admin blogs endpoint status: ${adminResponse.status}`);

                    if (adminResponse.ok) {
                        const adminData = await adminResponse.json();
                        blogStatus.innerHTML += `
                            <div class="status success">‚úÖ Admin Blogs API Working!</div>
                            <p>Found ${adminData.data?.length || 0} admin blogs</p>
                        `;
                        log(`Found ${adminData.data?.length || 0} admin blogs`, 'success');
                    } else {
                        blogStatus.innerHTML += `
                            <div class="status error">‚ùå Admin endpoint failed: ${adminResponse.status}</div>
                        `;
                        log(`Admin endpoint failed: ${adminResponse.status}`, 'error');
                    }
                }
            } catch (error) {
                blogStatus.innerHTML = `<div class="status error">‚ùå Error: ${error.message}</div>`;
                log(`Blog fetch error: ${error.message}`, 'error');
            }
        }

        async function testCommunity() {
            const communityStatus = document.getElementById('communityStatus');
            communityStatus.innerHTML = '<div class="status warning">‚è≥ Fetching community data...</div>';
            log('Fetching community data...');

            try {
                // Test mentors
                const mentorsResponse = await fetch(`${API_BASE_URL}/community/mentors`);
                log(`Mentors endpoint status: ${mentorsResponse.status}`);

                // Test events
                const eventsResponse = await fetch(`${API_BASE_URL}/community/events`);
                log(`Events endpoint status: ${eventsResponse.status}`);

                // Test stories
                const storiesResponse = await fetch(`${API_BASE_URL}/community/stories`);
                log(`Stories endpoint status: ${storiesResponse.status}`);

                // Test resources
                const resourcesResponse = await fetch(`${API_BASE_URL}/community/resources`);
                log(`Resources endpoint status: ${resourcesResponse.status}`);

                let html = '';

                if (mentorsResponse.ok) {
                    const mentorsData = await mentorsResponse.json();
                    html += `<div class="status success">‚úÖ Mentors: ${mentorsData.data?.length || 0} found</div>`;
                    log(`Found ${mentorsData.data?.length || 0} mentors`, 'success');
                } else {
                    html += `<div class="status error">‚ùå Mentors failed: ${mentorsResponse.status}</div>`;
                }

                if (eventsResponse.ok) {
                    const eventsData = await eventsResponse.json();
                    html += `<div class="status success">‚úÖ Events: ${eventsData.data?.length || 0} found</div>`;
                    log(`Found ${eventsData.data?.length || 0} events`, 'success');
                } else {
                    html += `<div class="status error">‚ùå Events failed: ${eventsResponse.status}</div>`;
                }

                if (storiesResponse.ok) {
                    const storiesData = await storiesResponse.json();
                    html += `<div class="status success">‚úÖ Stories: ${storiesData.data?.length || 0} found</div>`;
                    log(`Found ${storiesData.data?.length || 0} stories`, 'success');
                } else {
                    html += `<div class="status error">‚ùå Stories failed: ${storiesResponse.status}</div>`;
                }

                if (resourcesResponse.ok) {
                    const resourcesData = await resourcesResponse.json();
                    html += `<div class="status success">‚úÖ Resources: ${resourcesData.data?.length || 0} found</div>`;
                    log(`Found ${resourcesData.data?.length || 0} resources`, 'success');
                } else {
                    html += `<div class="status error">‚ùå Resources failed: ${resourcesResponse.status}</div>`;
                }

                communityStatus.innerHTML = html;
            } catch (error) {
                communityStatus.innerHTML = `<div class="status error">‚ùå Error: ${error.message}</div>`;
                log(`Community fetch error: ${error.message}`, 'error');
            }
        }

        // Auto-run auth check on load
        window.addEventListener('load', () => {
            log('Debug page loaded');
            checkAuth();
        });
    </script>
</body>

</html>