<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Blog Management - Admin Dashboard</title>
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Serif:ital,wght@0,100..900;1,100..900&family=Noto+Sans:ital,wght@0,100..900;1,100..900&display=swap"
        rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet" />
    <link href="assets/css/main.css" rel="stylesheet" />
    <link href="assets/css/blog-builder.css" rel="stylesheet" />
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#6605c7",
                        "background-light": "#f7f5f8",
                        "background-dark": "#190f23",
                        "gold-accent": "#e0c389",
                    },
                    fontFamily: {
                        "display": ["'Noto Serif'", "serif"],
                        "sans": ["'Noto Sans'", "sans-serif"],
                    },
                    backgroundImage: {
                        'mesh-gradient': 'radial-gradient(at 0% 0%, rgba(102, 5, 199, 0.4) 0px, transparent 50%), radial-gradient(at 100% 0%, rgba(224, 195, 137, 0.5) 0px, transparent 50%), radial-gradient(at 100% 100%, rgba(139, 192, 232, 0.4) 0px, transparent 50%), radial-gradient(at 0% 100%, rgba(102, 5, 199, 0.3) 0px, transparent 50%)',
                    }
                },
            },
        };
    </script>
    <style>
        /* Initial nav text colors (black) */
        .nav-link {
            color: rgba(0, 0, 0, 0.9) !important;
        }

        .nav-link.active {
            color: #a855f7 !important;
        }

        /* .font-display {
            color: black !important;
        } */

        #loginLink {
            color: rgba(0, 0, 0, 0.9) !important;
        }

        .material-symbols-outlined {
            color: black !important;
        }

        /* Keep dropdown icons purple initially */
        #profileDropdown .material-symbols-outlined {
            color: #6605c7 !important;
        }

        /* White text when scrolled */
        .nav-scrolled .nav-link {
            color: rgba(255, 255, 255, 0.9) !important;
        }

        .nav-scrolled .nav-link:hover {
            color: #6605c7 !important;
        }

        .nav-scrolled .font-display {
            color: white !important;
        }

        .nav-scrolled #loginLink {
            color: rgba(255, 255, 255, 0.9) !important;
        }

        .nav-scrolled #loginLink:hover {
            color: #6605c7 !important;
        }

        .nav-scrolled .material-symbols-outlined {
            color: white !important;
        }

        /* Keep dropdown icons visible */
        .nav-scrolled #profileDropdown .material-symbols-outlined {
            color: #6605c7 !important;
        }

        /* Active page indicator */
        .nav-link.active,
        .nav-dropdown-toggle.active {
            color: #a855f7 !important;
            position: relative;
        }

        .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(to right, #a855f7, #c084fc);
            border-radius: 2px;
        }

        .nav-dropdown-item.active {
            background: rgba(168, 85, 247, 0.15);
            border-left-color: #a855f7;
            color: #a855f7;
        }

        .nav-scrolled .nav-link.active,
        .nav-scrolled .nav-dropdown-toggle.active {
            color: #a855f7 !important;
        }

        .admin-form {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
        }

        .dark .admin-form {
            background: rgba(25, 15, 35, 0.8);
        }

        /* Font Style Preview Classes */
        .font-style-formal {
            font-family: 'Noto Serif', Georgia, serif;
            letter-spacing: 0.3px;
            line-height: 1.8;
        }

        .font-style-modern {
            font-family: 'Noto Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            letter-spacing: 0.2px;
            line-height: 1.6;
        }

        .font-style-casual {
            font-family: 'Courier New', monospace;
            letter-spacing: 0px;
            line-height: 1.5;
            background: #f5f5f5;
            padding: 12px;
            border-radius: 4px;
        }

        .dark .font-style-casual {
            background: #2a2a2a;
        }

        .template-preview {
            background: #f9fafb;
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 16px;
            margin: 12px 0;
            font-size: 0.875rem;
            color: #6b7280;
            line-height: 1.5;
        }

        .dark .template-preview {
            background: #1f2937;
            border-color: #4b5563;
            color: #d1d5db;
        }

        /* Template Gallery Card Styles */
        .template-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(245, 245, 245, 0.95) 100%);
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 24px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .template-card:hover {
            border-color: #6605c7;
            box-shadow: 0 12px 30px rgba(102, 5, 199, 0.15);
            transform: translateY(-4px);
        }

        .dark .template-card {
            background: linear-gradient(135deg, rgba(31, 41, 55, 0.8) 0%, rgba(17, 24, 39, 0.9) 100%);
            border-color: #4b5563;
        }

        .dark .template-card:hover {
            border-color: #a855f7;
            box-shadow: 0 12px 30px rgba(168, 85, 247, 0.2);
        }

        .template-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .template-card-icon {
            font-size: 32px;
        }

        .template-card-title {
            font-size: 16px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 8px;
        }

        .dark .template-card-title {
            color: #f3f4f6;
        }

        .template-card-description {
            font-size: 13px;
            color: #6b7280;
            line-height: 1.5;
            margin-bottom: 12px;
        }

        .dark .template-card-description {
            color: #d1d5db;
        }

        .template-card-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 12px;
        }

        .template-tag {
            display: inline-block;
            padding: 4px 8px;
            background: rgba(102, 5, 199, 0.1);
            color: #6605c7;
            font-size: 11px;
            border-radius: 6px;
            font-weight: 600;
        }

        .dark .template-tag {
            background: rgba(168, 85, 247, 0.2);
            color: #c084fc;
        }

        .template-select-btn {
            width: 100%;
            padding: 10px 16px;
            background: linear-gradient(135deg, #6605c7 0%, #8b2be2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .template-select-btn:hover {
            box-shadow: 0 8px 16px rgba(102, 5, 199, 0.3);
            transform: scale(1.02);
        }

        /* Image Upload Styles */
        #imagePreview {
            display: block;
            width: 100%;
            height: auto;
            max-height: 300px;
        }

        #imageUpload::-webkit-file-upload-button {
            display: none;
        }

        /* File input label hover effect */
        label[for="imageUpload"]:hover {
            background-color: rgba(102, 5, 199, 0.05);
            border-color: #6605c7;
        }

        .dark label[for="imageUpload"]:hover {
            background-color: rgba(102, 5, 199, 0.15);
        }

        /* Color scheme button active state */
        button[onclick*="setColorScheme"].active {
            box-shadow: 0 0 12px rgba(102, 5, 199, 0.4);
            transform: scale(1.05);
        }
    </style>
</head>

<body
    class="bg-background-light dark:bg-background-dark min-h-screen font-sans transition-colors duration-500 text-gray-900 dark:text-gray-100 relative">

    <div class="fixed inset-0 z-0 bg-background-light dark:bg-background-dark pointer-events-none">
        <div class="absolute inset-0 bg-mesh-gradient opacity-90"></div>
        <div class="absolute inset-0 opacity-30 mix-blend-overlay"
            style="background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuCSQJcRexkqlKu3kzwZCWIGdx9mSdhvK4Je6lxA9kVrWHQFg-ShCu6j3XLipgBh0waP45VYm3rBVD2Psy-FTMp2qLU946EXQwD2sIGZJLe5tw2ugWPYnnOTMWoTGM95X4u1epiDmYaEV_vVdH7tyv2ZlDuFjSMZlzWulHW3UyesMipUWi30MryHEiz-_Lje83ApXK-FpMUQdIEWe0M_ZFfiu3BcH1_opus8b5qOTiMh8tMBAX7ifzSLR_qpWnWtdB8obUzknDxLtfeP');">
        </div>
    </div>

    <!-- Navigation -->
    <div id="navbar-placeholder"></div>

    <!-- Main Content -->
    <main class="pt-32 pb-16 px-6">
        <div class="max-w-7xl mx-auto">
            <!-- Header -->
            <div class="text-center mb-12">
                <h1 class="text-4xl md:text-5xl font-bold font-display text-gray-900 dark:text-white mb-4">
                    Blog Management
                </h1>
                <p class="text-lg text-gray-600 dark:text-gray-300 max-w-2xl mx-auto">
                    Create, edit, and manage your blog posts with our intuitive admin interface.
                </p>
            </div>

            <!-- Top Section: Form and Stats -->
            <div class="grid lg:grid-cols-4 gap-6 mb-8">
                <!-- Quick Stats Cards -->
                <div class="admin-form rounded-xl p-6 shadow-lg border border-gray-200/50 dark:border-gray-700/50">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-1">Total
                                Blogs</p>
                            <p class="text-3xl font-bold text-primary" id="totalBlogs">0</p>
                        </div>
                        <span class="material-symbols-outlined text-4xl text-primary/20">article</span>
                    </div>
                </div>
                <div class="admin-form rounded-xl p-6 shadow-lg border border-gray-200/50 dark:border-gray-700/50">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-1">Published
                            </p>
                            <p class="text-3xl font-bold text-green-600" id="publishedBlogs">0</p>
                        </div>
                        <span class="material-symbols-outlined text-4xl text-green-600/20">check_circle</span>
                    </div>
                </div>
                <div class="admin-form rounded-xl p-6 shadow-lg border border-gray-200/50 dark:border-gray-700/50">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-1">Drafts</p>
                            <p class="text-3xl font-bold text-orange-600" id="draftBlogs">0</p>
                        </div>
                        <span class="material-symbols-outlined text-4xl text-orange-600/20">edit_note</span>
                    </div>
                </div>
                <div class="admin-form rounded-xl p-6 shadow-lg border border-gray-200/50 dark:border-gray-700/50">
                    <button id="createNewBtn"
                        class="w-full h-full flex flex-col items-center justify-center gap-2 hover:bg-primary/5 transition-colors rounded-lg">
                        <span class="material-symbols-outlined text-4xl text-primary">add_circle</span>
                        <p class="text-sm font-semibold text-primary">Create New Blog</p>
                    </button>
                </div>
            </div>

            <!-- All Blogs Table -->
            <div
                class="admin-form rounded-2xl shadow-xl border border-gray-200/50 dark:border-gray-700/50 overflow-hidden">
                <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                    <div class="flex items-center justify-between">
                        <h2 class="text-2xl font-bold font-display text-gray-900 dark:text-white flex items-center">
                            <span class="material-symbols-outlined text-primary mr-2">library_books</span>
                            All Blogs
                        </h2>
                        <button id="refreshBlogs"
                            class="px-4 py-2 text-sm text-gray-600 dark:text-gray-400 hover:text-primary transition-colors flex items-center gap-2">
                            <span class="material-symbols-outlined">refresh</span>
                            Refresh
                        </button>
                    </div>
                </div>

                <div id="blogsTableContainer" class="overflow-x-auto">
                    <!-- Table will be populated here -->
                    <div class="text-center py-12 text-gray-500 dark:text-gray-400">
                        <span class="material-symbols-outlined text-5xl mb-4 block">article</span>
                        <p class="text-lg mb-2">Loading blogs...</p>
                    </div>
                </div>
            </div>

            <!-- Template Gallery Modal -->
            <div id="templateGalleryModal"
                class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
                <div class="admin-form rounded-2xl shadow-2xl max-w-6xl w-full max-h-[95vh] overflow-y-auto">
                    <div
                        class="sticky top-0 bg-white dark:bg-gray-900 p-6 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between">
                        <h2 class="text-2xl font-bold font-display text-gray-900 dark:text-white">‚ú® Choose Blog Template
                        </h2>
                        <button onclick="closeTemplateGallery()"
                            class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                            <span class="material-symbols-outlined text-2xl">close</span>
                        </button>
                    </div>
                    <div class="p-6">
                        <div id="templateGalleryContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <!-- Templates will be populated here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Blog Builder Modal (Canvas-like interface) -->
            <div id="blogFormModal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
                <div class="admin-form rounded-2xl shadow-2xl max-w-full w-full max-h-[95vh] overflow-hidden flex flex-col">
                    <!-- Header with toolbar -->
                    <div class="sticky top-0 bg-white dark:bg-gray-900 p-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between z-10">
                        <div class="flex items-center gap-4">
                            <h2 class="text-2xl font-bold font-display text-gray-900 dark:text-white flex items-center">
                                <span class="material-symbols-outlined text-primary mr-2">edit</span>
                                <span id="formTitle">‚ú® Blog Builder</span>
                            </h2>
                            <span id="autoSaveIndicator" class="text-xs text-gray-500 dark:text-gray-400">‚Ä¢ Auto-saving...</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <button id="undoBtn" class="p-2 text-gray-600 hover:text-primary hover:bg-primary/10 rounded-lg transition-colors" title="Undo">
                                <span class="material-symbols-outlined">undo</span>
                            </button>
                            <button id="redoBtn" class="p-2 text-gray-600 hover:text-primary hover:bg-primary/10 rounded-lg transition-colors" title="Redo">
                                <span class="material-symbols-outlined">redo</span>
                            </button>
                            <div class="border-l border-gray-200 dark:border-gray-700 mx-2 h-6"></div>
                            <button id="previewBtn" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors flex items-center gap-2 text-sm" title="Preview">
                                <span class="material-symbols-outlined text-lg">visibility</span>
                                Preview
                            </button>
                            <button id="closeModal" class="p-2 text-gray-600 hover:text-gray-800 dark:hover:text-gray-400">
                                <span class="material-symbols-outlined text-2xl">close</span>
                            </button>
                        </div>
                    </div>

                    <div class="flex flex-1 overflow-hidden">
                        <!-- Left Sidebar: Element Palette -->
                        <div class="w-64 bg-gray-50 dark:bg-gray-800/50 border-r border-gray-200 dark:border-gray-700 overflow-y-auto">
                            <div class="p-4 space-y-6">
                                <!-- Elements Section -->
                                <div>
                                    <h3 class="text-sm font-bold font-display text-gray-900 dark:text-white mb-3">üì¶ ELEMENTS</h3>
                                    <div class="space-y-2">
                                        <div class="draggable-element" data-type="heading" draggable="true" class="flex items-center gap-2 p-3 bg-white dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600 cursor-grab hover:shadow-md transition-all">
                                            <span class="material-symbols-outlined text-sm text-primary">title</span>
                                            <span class="text-sm font-medium">Heading</span>
                                        </div>
                                        <div class="draggable-element" data-type="text" draggable="true" class="flex items-center gap-2 p-3 bg-white dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600 cursor-grab hover:shadow-md transition-all">
                                            <span class="material-symbols-outlined text-sm text-primary">text_fields</span>
                                            <span class="text-sm font-medium">Text</span>
                                        </div>
                                        <div class="draggable-element" data-type="image" draggable="true" class="flex items-center gap-2 p-3 bg-white dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600 cursor-grab hover:shadow-md transition-all">
                                            <span class="material-symbols-outlined text-sm text-primary">image</span>
                                            <span class="text-sm font-medium">Image</span>
                                        </div>
                                        <div class="draggable-element" data-type="video" draggable="true" class="flex items-center gap-2 p-3 bg-white dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600 cursor-grab hover:shadow-md transition-all">
                                            <span class="material-symbols-outlined text-sm text-primary">video_camera</span>
                                            <span class="text-sm font-medium">Video</span>
                                        </div>
                                        <div class="draggable-element" data-type="button" draggable="true" class="flex items-center gap-2 p-3 bg-white dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600 cursor-grab hover:shadow-md transition-all">
                                            <span class="material-symbols-outlined text-sm text-primary">smart_button</span>
                                            <span class="text-sm font-medium">Button</span>
                                        </div>
                                        <div class="draggable-element" data-type="divider" draggable="true" class="flex items-center gap-2 p-3 bg-white dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600 cursor-grab hover:shadow-md transition-all">
                                            <span class="material-symbols-outlined text-sm text-primary">remove</span>
                                            <span class="text-sm font-medium">Divider</span>
                                        </div>
                                        <div class="draggable-element" data-type="grid" draggable="true" class="flex items-center gap-2 p-3 bg-white dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600 cursor-grab hover:shadow-md transition-all">
                                            <span class="material-symbols-outlined text-sm text-primary">dashboard</span>
                                            <span class="text-sm font-medium">Grid</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Design Tools Section -->
                                <div>
                                    <h3 class="text-sm font-bold font-display text-gray-900 dark:text-white mb-3">üé® DESIGN</h3>
                                    <div class="space-y-3">
                                        <div>
                                            <label class="text-xs font-semibold text-gray-700 dark:text-gray-300 block mb-2">Color</label>
                                            <input type="color" id="fontColorPicker" data-property="fontColor" class="w-full h-10 rounded-lg cursor-pointer border border-gray-300 dark:border-gray-600">
                                        </div>
                                        <div>
                                            <label class="text-xs font-semibold text-gray-700 dark:text-gray-300 block mb-2">Background</label>
                                            <input type="color" id="bgColorPicker" data-property="backgroundColor" class="w-full h-10 rounded-lg cursor-pointer border border-gray-300 dark:border-gray-600">
                                        </div>
                                        <div>
                                            <label class="text-xs font-semibold text-gray-700 dark:text-gray-300 block mb-2">Font Size</label>
                                            <input type="number" id="fontSizeInput" data-tool="fontSize" min="8" max="72" value="16" class="w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-sm">
                                        </div>
                                        <div>
                                            <label class="text-xs font-semibold text-gray-700 dark:text-gray-300 block mb-2">Font Weight</label>
                                            <select id="fontWeightSelect" data-tool="fontWeight" class="w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-sm">
                                                <option value="normal">Normal</option>
                                                <option value="bold">Bold</option>
                                                <option value="lighter">Lighter</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="text-xs font-semibold text-gray-700 dark:text-gray-300 block mb-2">Font Family</label>
                                            <select id="fontFamilySelect" data-tool="fontFamily" class="w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-sm">
                                                <option value="serif">Serif</option>
                                                <option value="sans-serif">Sans-serif</option>
                                                <option value="monospace">Monospace</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <!-- Layer Tools -->
                                <div>
                                    <h3 class="text-sm font-bold font-display text-gray-900 dark:text-white mb-3">üìö LAYERS</h3>
                                    <div class="space-y-2">
                                        <button id="bringToFrontBtn" data-tool="bringToFront" class="w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-xs font-medium flex items-center gap-2 hover:bg-primary/10 transition-colors">
                                            <span class="material-symbols-outlined text-sm">arrow_upward</span>
                                            Bring Forward
                                        </button>
                                        <button id="sendToBackBtn" data-tool="sendToBack" class="w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-xs font-medium flex items-center gap-2 hover:bg-primary/10 transition-colors">
                                            <span class="material-symbols-outlined text-sm">arrow_downward</span>
                                            Send Backward
                                        </button>
                                    </div>
                                </div>

                                <!-- Blog Metadata -->
                                <div>
                                    <h3 class="text-sm font-bold font-display text-gray-900 dark:text-white mb-3">üìã METADATA</h3>
                                    <div class="space-y-3">
                                        <input type="hidden" id="blogId" value="">
                                        <input type="text" id="blogTitle" placeholder="Blog Title" class="w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-xs">
                                        <input type="text" id="blogSlug" placeholder="URL Slug" class="w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-xs">
                                        <select id="blogCategory" class="w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-xs">
                                            <option value="">Category</option>
                                            <option value="education">Education</option>
                                            <option value="finance">Finance</option>
                                            <option value="loans">Loans</option>
                                            <option value="student-life">Student Life</option>
                                            <option value="career">Career</option>
                                            <option value="tips">Tips & Tricks</option>
                                        </select>
                                        <input type="text" id="blogAuthor" placeholder="Author Name" class="w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-xs">
                                        <input type="text" id="blogExcerpt" placeholder="Excerpt" class="w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-xs">
                                        <input type="text" id="blogTags" placeholder="Tags (comma separated)" class="w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-xs">
                                        <div class="flex items-center gap-2">
                                            <input type="checkbox" id="blogPublished" class="w-4 h-4">
                                            <label for="blogPublished" class="text-xs font-medium text-gray-700 dark:text-gray-300">Publish</label>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <input type="checkbox" id="blogFeatured" class="w-4 h-4">
                                            <label for="blogFeatured" class="text-xs font-medium text-gray-700 dark:text-gray-300">Featured</label>
                                        </div>
                                    </div>
                                </div>

                                <!-- Action Buttons -->
                                <div class="space-y-2 pt-4 border-t border-gray-200 dark:border-gray-700">
                                    <button id="saveBtn" class="w-full px-4 py-2 bg-primary hover:bg-primary/90 text-white rounded-lg font-semibold text-sm transition-all flex items-center justify-center gap-2">
                                        <span class="material-symbols-outlined">save</span>
                                        Save Blog
                                    </button>
                                    <button id="clearCanvasBtn" class="w-full px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-semibold text-sm transition-all flex items-center justify-center gap-2">
                                        <span class="material-symbols-outlined">delete</span>
                                        Clear Canvas
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Center: Canvas Area -->
                        <div class="flex-1 flex flex-col overflow-hidden bg-gray-100 dark:bg-gray-900">
                            <div id="builderCanvasContainer" class="flex-1 p-6 overflow-auto"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Blog View Modal (Hidden by default) -->
            <div id="blogViewModal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
                <div class="admin-form rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                    <div
                        class="sticky top-0 bg-white dark:bg-gray-900 p-6 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between">
                        <h2 class="text-2xl font-bold font-display text-gray-900 dark:text-white flex items-center">
                            <span class="material-symbols-outlined text-primary mr-2">visibility</span>
                            <span id="viewTitle">Blog Preview</span>
                        </h2>
                        <div class="flex items-center gap-2">
                            <button id="editFromView"
                                class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors flex items-center gap-2">
                                <span class="material-symbols-outlined text-lg">edit</span>
                                Edit
                            </button>
                            <button id="closeViewModal"
                                class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                                <span class="material-symbols-outlined text-2xl">close</span>
                            </button>
                        </div>
                    </div>

                    <div id="viewContent" class="p-8">
                        <!-- Content will be populated dynamically -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Success/Error Messages -->
    <div id="messageToast" class="fixed bottom-6 right-6 z-50 hidden">
        <div class="glass-card rounded-xl p-4 shadow-xl max-w-sm">
            <div class="flex items-center gap-3">
                <span class="material-symbols-outlined text-green-600" id="messageIcon">check_circle</span>
                <p class="text-sm font-medium text-gray-900 dark:text-white" id="messageText"></p>
            </div>
        </div>
    </div>





    <script src="assets/js/components-loader.js"></script>
    <script src="assets/js/auth.js"></script>
    <script src="assets/js/theme-toggle.js"></script>
    <!-- Blog Builder Scripts -->
    <script src="assets/js/blog-builder/utils.js"></script>
    <script src="assets/js/blog-builder/element-manager.js"></script>
    <script src="assets/js/blog-builder/undo-redo.js"></script>
    <script src="assets/js/blog-builder/auto-save.js"></script>
    <script src="assets/js/blog-builder/export-engine.js"></script>
    <script src="assets/js/blog-builder/design-tools.js"></script>
    <script src="assets/js/blog-builder/canvas-manager.js"></script>
    <script src="assets/js/blog-builder/drag-drop-handler.js"></script>
    <script>
        // Blog Templates with Enhanced Design
        const blogTemplates = {
            'how-to': {
                title: 'How-To Guide Template',
                excerpt: 'A comprehensive guide on how to accomplish a specific task or achieve a goal.',
                content: `## Introduction
Start with an engaging introduction that explains what readers will learn from this guide.

## What You'll Need
List any prerequisites, tools, or materials needed to complete the task.

## Step-by-Step Instructions

### Step 1: [First Action]
Provide clear, detailed instructions for the first step. Include any important tips or common mistakes to avoid.

### Step 2: [Second Action]
Continue with the next step. Use numbered sections for clarity.

### Step 3: [Third Action]
Add more steps as needed.

## Tips & Tricks
Share pro tips and best practices learned from experience.

## Common Mistakes to Avoid
List potential pitfalls and how to avoid them.

## Conclusion
Wrap up with a summary and encourage readers to try the steps themselves.`,
                color: '#6605c7',
                layout: 'structured'
            },
            'news': {
                title: 'News Article Template',
                excerpt: 'Report on the latest news, updates, and industry insights relevant to your audience.',
                content: `## Headline Summary
Provide a brief, compelling summary of the news or announcement in the first paragraph.

## Key Details
### What Happened
Explain the main event or news story in detail.

### When Did It Happen
Provide specific dates and timeline information.

### Why It Matters
Explain the significance and impact of this news for your readers.

## Expert Insights
Include relevant quotes or perspectives from industry experts or key stakeholders.

## What's Next
Discuss the expected outcomes and what readers should expect moving forward.

## Related Resources
Link to related articles or resources for readers interested in learning more.

## Conclusion
Summarize the key takeaways and implications.`,
                color: '#e0c389',
                layout: 'modern'
            },
            'opinion': {
                title: 'Opinion Piece Template',
                excerpt: 'Share your thoughts, perspectives, and insights on a relevant topic.',
                content: `## The Issue at Hand
Start by clearly stating the topic or issue you're discussing and why it matters now.

## My Perspective
Present your main viewpoint and the reasoning behind it. Be clear and confident in your position.

## Supporting Arguments

### Argument 1
Provide the first supporting argument with evidence or examples.

### Argument 2
Present additional supporting points that strengthen your perspective.

### Argument 3
Add more arguments as needed to build your case.

## Addressing Counterarguments
Acknowledge opposing views and respectfully explain why you believe your perspective is stronger.

## Call to Action
End with a clear call to action or invitation for readers to share their thoughts.

## Conclusion
Summarize your main points and reaffirm your position.`,
                color: '#3b82f6',
                layout: 'minimal'
            },
            'tutorial': {
                title: 'Tutorial Template',
                excerpt: 'Step-by-step tutorial with visual demonstrations and code examples.',
                content: `## Overview
Brief overview of what this tutorial covers and what users will learn.

## Prerequisites
- Requirement 1
- Requirement 2
- Requirement 3

## Getting Started
Introduction and setup instructions.

## Main Content

### Part 1: [Section]
First major section with detailed explanations.

### Part 2: [Section]
Second section building on previous knowledge.

### Part 3: [Section]
Final section with advanced concepts.

## Best Practices
Key takeaways and recommended approaches.

## Troubleshooting
Common issues and solutions.

## Resources
Additional links and references.`,
                color: '#10b981',
                layout: 'comprehensive'
            },
            'case-study': {
                title: 'Case Study Template',
                excerpt: 'In-depth analysis of a real-world project or scenario with results.',
                content: `## Executive Summary
Brief overview of the case study and key results.

## Background
Context and situation before the solution was implemented.

## Challenge
The main problem that needed to be solved.

## Solution
How the problem was addressed and what approach was taken.

## Implementation
Steps taken to execute the solution.

## Results
Measurable outcomes and impact.

## Lessons Learned
Key takeaways and insights from this project.

## Conclusion
Final thoughts and recommendations for similar situations.`,
                color: '#f59e0b',
                layout: 'professional'
            }
        };

        // Design Layouts
        const designLayouts = {
            structured: { name: 'üìä Structured', desc: 'Organized with clear sections' },
            modern: { name: 'üé® Modern', desc: 'Contemporary and bold' },
            minimal: { name: '‚ö™ Minimal', desc: 'Clean and simple' },
            comprehensive: { name: 'üìö Comprehensive', desc: 'Detailed with depth' },
            professional: { name: 'üíº Professional', desc: 'Corporate and formal' }
        };

        // Color Schemes
        const colorSchemes = {
            purple: { name: 'üü£ Purple', primary: '#6605c7', secondary: '#a855f7', accent: '#e0c389' },
            blue: { name: 'üîµ Blue', primary: '#3b82f6', secondary: '#60a5fa', accent: '#fbbf24' },
            green: { name: 'üü¢ Green', primary: '#10b981', secondary: '#34d399', accent: '#fbbf24' },
            amber: { name: 'üü† Amber', primary: '#f59e0b', secondary: '#fbbf24', accent: '#3b82f6' },
            rose: { name: 'üåπ Rose', primary: '#ec4899', secondary: '#f472b6', accent: '#60a5fa' }
        };

        // Font Styles Configuration
        const fontStyles = {
            formal: { name: 'Formal (Serif)', class: 'font-style-formal' },
            modern: { name: 'Modern (Sans-Serif)', class: 'font-style-modern' },
            casual: { name: 'Casual (Monospace)', class: 'font-style-casual' }
        };

        // API Configuration
        const API_BASE_URL = 'http://localhost:3000';
        let authToken = localStorage.getItem('authToken') || '';
        let currentFontStyle = 'formal';
        let currentColorScheme = 'purple';
        let currentLayout = '';

        // Template Gallery Functions
        function openTemplateGallery() {
            renderTemplateGallery();
            document.getElementById('templateGalleryModal').classList.remove('hidden');
        }

        function closeTemplateGallery() {
            document.getElementById('templateGalleryModal').classList.add('hidden');
        }

        function renderTemplateGallery() {
            const container = document.getElementById('templateGalleryContainer');
            const templates = Object.entries(blogTemplates);

            container.innerHTML = templates.map(([key, template]) => `
                <div class="template-card">
                    <div class="template-card-header">
                        <div class="template-card-icon">
                            ${getTemplateIcon(key)}
                        </div>
                        <div style="color: ${template.color}; font-size: 20px;">‚óè</div>
                    </div>
                    <h3 class="template-card-title">${template.title}</h3>
                    <p class="template-card-description">${template.excerpt}</p>
                    <div class="template-card-tags">
                        <span class="template-tag">${designLayouts[template.layout].name}</span>
                    </div>
                    <button type="button" onclick="selectTemplate('${key}')" class="template-select-btn">
                        Use This Template
                    </button>
                </div>
            `).join('');
        }

        function getTemplateIcon(templateKey) {
            const icons = {
                'how-to': 'üìò',
                'news': 'üì∞',
                'opinion': 'üí≠',
                'tutorial': 'üéì',
                'case-study': 'üìä'
            };
            return icons[templateKey] || 'üìÑ';
        }

        function selectTemplate(templateKey) {
            const template = blogTemplates[templateKey];
            if (!template) return;

            // Populate form fields
            document.getElementById('blogExcerpt').value = template.excerpt;
            document.getElementById('blogContent').value = template.content;

            // Set layout if available
            if (template.layout) {
                document.getElementById('layoutSelect').value = template.layout;
                currentLayout = template.layout;
            }

            // Update content color
            const contentField = document.getElementById('blogContent');
            contentField.style.borderColor = template.color;

            // Show success message
            showMessage(`‚ú® Template "${template.title}" applied! Customize as needed.`, 'check_circle', 'green');

            // Close gallery
            closeTemplateGallery();

            // Scroll to content
            setTimeout(() => {
                document.getElementById('blogContent').scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 300);
        }

        function updateLayout(layoutValue) {
            currentLayout = layoutValue;
            if (layoutValue) {
                showMessage(`Layout changed to: ${designLayouts[layoutValue].name}`, 'check_circle', 'blue');
            }
        }

        function setColorScheme(scheme) {
            currentColorScheme = scheme;

            // Update button states
            document.querySelectorAll('button[onclick*="setColorScheme"]').forEach(btn => {
                btn.classList.remove('active');
                btn.style.borderWidth = '1px';
            });

            const activeBtn = document.querySelector(`button[onclick="setColorScheme('${scheme}')"]`);
            if (activeBtn) {
                activeBtn.classList.add('active');
                activeBtn.style.borderWidth = '2px';
            }

            // Update form styling
            const contentField = document.getElementById('blogContent');
            const schemeConfig = colorSchemes[scheme];
            contentField.style.borderColor = schemeConfig.primary;
            contentField.style.boxShadow = `0 0 0 3px ${schemeConfig.primary}10`;

            showMessage(`Color scheme: ${schemeConfig.name}`, 'palette', 'green');
        }

        function updateFontStyle(style) {
            currentFontStyle = style;
            const contentField = document.getElementById('blogContent');

            // Remove all font style classes
            Object.values(fontStyles).forEach(s => {
                contentField.classList.remove(s.class);
            });

            // Add selected font style
            if (fontStyles[style]) {
                contentField.classList.add(fontStyles[style].class);
            }

            showMessage(`Typography: ${fontStyles[style].name}`, 'text_fields', 'green');
        }

        // Image Handling Functions
        let uploadedImageData = null;

        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Validate file size (5MB max)
            const maxSize = 5 * 1024 * 1024; // 5MB
            if (file.size > maxSize) {
                showMessage('Image size must be less than 5MB', 'error', 'red');
                return;
            }

            // Validate file type
            const validTypes = ['image/jpeg', 'image/png', 'image/webp'];
            if (!validTypes.includes(file.type)) {
                showMessage('Only JPG, PNG, and WebP formats are supported', 'error', 'red');
                return;
            }

            // Read file as data URL
            const reader = new FileReader();
            reader.onload = function (e) {
                uploadedImageData = e.target.result;
                document.getElementById('blogImage').value = uploadedImageData;
                updateImagePreview();
                showMessage('Image uploaded successfully!', 'check_circle', 'green');
            };
            reader.onerror = function () {
                showMessage('Error reading image file', 'error', 'red');
            };
            reader.readAsDataURL(file);
        }

        function updateImagePreview() {
            const imageUrl = document.getElementById('blogImage').value;
            const previewContainer = document.getElementById('imagePreviewContainer');
            const imagePreview = document.getElementById('imagePreview');
            const imageSizeInfo = document.getElementById('imageSizeInfo');

            if (imageUrl && imageUrl.trim() !== '') {
                // Validate if it's a valid data URL or HTTP URL
                if (imageUrl.startsWith('data:') || imageUrl.startsWith('http://') || imageUrl.startsWith('https://')) {
                    imagePreview.src = imageUrl;
                    imagePreview.onload = function () {
                        const sizeInBytes = imageUrl.length;
                        const sizeInKB = (sizeInBytes / 1024).toFixed(2);
                        imageSizeInfo.textContent = `Image Size: ${sizeInKB} KB`;
                        previewContainer.classList.remove('hidden');
                    };
                    imagePreview.onerror = function () {
                        showMessage('Failed to load image. Check the URL.', 'error', 'red');
                        previewContainer.classList.add('hidden');
                    };
                } else {
                    previewContainer.classList.add('hidden');
                }
            } else {
                previewContainer.classList.add('hidden');
                uploadedImageData = null;
            }
        }

        function removeImage() {
            document.getElementById('blogImage').value = '';
            document.getElementById('imageUpload').value = '';
            document.getElementById('imagePreviewContainer').classList.add('hidden');
            uploadedImageData = null;
            showMessage('Image removed', 'delete', 'blue');
        }

        // Helper function to generate slug from title
        function generateSlug(title) {
            return title
                .toLowerCase()
                .replace(/[^\w\s-]/g, '')
                .replace(/\s+/g, '-')
                .replace(/--+/g, '-')
                .trim();
        }

        // Auto-generate slug from title
        document.getElementById('blogTitle')?.addEventListener('input', function (e) {
            const slugInput = document.getElementById('blogSlug');
            if (slugInput && !slugInput.dataset.userEdited) {
                slugInput.value = generateSlug(e.target.value);
            }
        });

        document.getElementById('blogSlug')?.addEventListener('input', function () {
            this.dataset.userEdited = 'true';
        });

        // Show message toast
        function showMessage(text, icon, color) {
            const toast = document.getElementById('messageToast');
            const iconEl = document.getElementById('messageIcon');
            const textEl = document.getElementById('messageText');

            iconEl.textContent = icon;
            iconEl.className = `material-symbols-outlined text-${color}-600`;
            textEl.textContent = text;

            toast.classList.remove('hidden');
            setTimeout(() => toast.classList.add('hidden'), 4000);
        }

        // Format date
        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return new Date(dateString).toLocaleDateString('en-US', options);
        }

        // Fetch all blogs
        async function loadBlogs() {
            try {
                const response = await fetch(`${API_BASE_URL}/blogs/admin/all`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.status === 401 || response.status === 403) {
                    // Authentication error
                    document.getElementById('blogsTableContainer').innerHTML = `
                        <div class="text-center py-12 px-6">
                            <span class="material-symbols-outlined text-5xl mb-4 block text-yellow-500">lock</span>
                            <p class="text-lg mb-2 font-semibold text-gray-900 dark:text-white">Authentication Required</p>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-6">You need to log in to access the admin panel.</p>
                            <div class="max-w-md mx-auto bg-gray-50 dark:bg-gray-800 rounded-lg p-6 text-left">
                                <p class="text-sm font-semibold mb-2">To log in:</p>
                                <ol class="text-sm text-gray-600 dark:text-gray-400 space-y-2 list-decimal list-inside">
                                    <li>Go to the <a href="login.html" class="text-primary hover:underline">Login Page</a></li>
                                    <li>Sign in with your credentials</li>
                                    <li>Return to this page</li>
                                </ol>
                                <p class="text-xs text-gray-500 mt-4">Or refresh this page after logging in.</p>
                            </div>
                        </div>
                    `;
                    return;
                }

                if (!response.ok) {
                    throw new Error(`Server returned ${response.status}: ${response.statusText}`);
                }

                const result = await response.json();
                const blogs = result.data || [];

                displayBlogs(blogs);
                updateStats(blogs);
            } catch (error) {
                console.error('Error loading blogs:', error);
                document.getElementById('blogsTableContainer').innerHTML = `
                    <div class="text-center py-12 text-gray-500 dark:text-gray-400">
                        <span class="material-symbols-outlined text-5xl mb-4 block text-red-500">error</span>
                        <p class="text-lg mb-2">Error loading blogs</p>
                        <p class="text-sm">${error.message}</p>
                        <button onclick="loadBlogs()" class="mt-4 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90">
                            Retry
                        </button>
                    </div>
                `;
            }
        }

        // Display blogs in table
        function displayBlogs(blogs) {
            const container = document.getElementById('blogsTableContainer');

            if (!blogs || blogs.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12 text-gray-500 dark:text-gray-400">
                        <span class="material-symbols-outlined text-5xl mb-4 block">article</span>
                        <p class="text-lg mb-2">No blogs found</p>
                        <p class="text-sm">Create your first blog post to get started!</p>
                    </div>
                `;
                return;
            }

            const tableHTML = `
                <table class="w-full">
                    <thead class="bg-gray-50 dark:bg-gray-800/50 border-b border-gray-200 dark:border-gray-700">
                        <tr>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider">Title</th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider">Category</th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider">Author</th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider">Status</th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider">Published</th>
                            <th class="px-6 py-4 text-right text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
                        ${blogs.map(blog => `
                            <tr class="hover:bg-gray-50 dark:hover:bg-gray-800/30 transition-colors">
                                <td class="px-6 py-4">
                                    <div class="flex items-center">
                                        ${blog.isFeatured ? '<span class="material-symbols-outlined text-yellow-500 mr-2 text-sm">star</span>' : ''}
                                        <div>
                                            <div class="font-semibold text-gray-900 dark:text-white">${blog.title}</div>
                                            <div class="text-xs text-gray-500 dark:text-gray-400 truncate max-w-md">${blog.excerpt || ''}</div>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-4">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary/10 text-primary capitalize">
                                        ${blog.category}
                                    </span>
                                </td>
                                <td class="px-6 py-4 text-sm text-gray-700 dark:text-gray-300">${blog.authorName || 'Unknown'}</td>
                                <td class="px-6 py-4">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${blog.isPublished
                    ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200'
                    : 'bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200'
                }">
                                        ${blog.isPublished ? 'Published' : 'Draft'}
                                    </span>
                                </td>
                                <td class="px-6 py-4 text-sm text-gray-500 dark:text-gray-400">
                                    ${blog.publishedAt ? formatDate(blog.publishedAt) : 'Not yet'}
                                </td>
                                <td class="px-6 py-4">
                                    <div class="flex items-center justify-end gap-2">
                                        <button onclick='viewBlog(${JSON.stringify(blog).replace(/'/g, "&apos;")})' 
                                            class="p-2 text-gray-600 hover:text-primary hover:bg-primary/10 rounded-lg transition-colors" 
                                            title="View">
                                            <span class="material-symbols-outlined text-lg">visibility</span>
                                        </button>
                                        <button onclick='editBlog(${JSON.stringify(blog).replace(/'/g, "&apos;")})' 
                                            class="p-2 text-blue-600 hover:text-blue-700 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors" 
                                            title="Edit">
                                            <span class="material-symbols-outlined text-lg">edit</span>
                                        </button>
                                        <button onclick="deleteBlog('${blog.id}', '${blog.title.replace(/'/g, "\\'")}' title="Delete"
                                            class="p-2 text-red-600 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors">
                                            <span class="material-symbols-outlined text-lg">delete</span>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            container.innerHTML = tableHTML;
        }

        // Update statistics
        function updateStats(blogs) {
            const total = blogs.length;
            const published = blogs.filter(b => b.isPublished).length;
            const drafts = total - published;

            document.getElementById('totalBlogs').textContent = total;
            document.getElementById('publishedBlogs').textContent = published;
            document.getElementById('draftBlogs').textContent = drafts;
        }

        // View blog details
        let currentViewingBlog = null;

        function viewBlog(blog) {
            console.log('ViewBlog called with:', blog);
            console.log('Blog content:', blog.content);
            console.log('Blog content length:', blog.content ? blog.content.length : 0);

            currentViewingBlog = blog;

            // Format tags
            const tagsHTML = blog.tags && blog.tags.length > 0
                ? blog.tags.map(tag => {
                    const tagName = typeof tag === 'string' ? tag : (tag.name || tag.tag?.name || 'tag');
                    return `<span class="inline-block px-3 py-1 bg-primary/10 text-primary rounded-full text-xs font-medium">${tagName}</span>`;
                }).join(' ')
                : '<span class="text-gray-500 italic">No tags</span>';

            // Format dates
            const createdDate = blog.createdAt ? formatDate(blog.createdAt) : 'Unknown';
            const publishedDate = blog.publishedAt ? formatDate(blog.publishedAt) : 'Not published';

            // Build view content
            const viewHTML = `
                <div class="space-y-6">
                    <!-- Featured Image -->
                    ${blog.featuredImage ? `
                        <div class="rounded-xl overflow-hidden">
                            <img src="${blog.featuredImage}" alt="${blog.title}" class="w-full h-64 object-cover">
                        </div>
                    ` : ''}
                    
                    <!-- Title & Meta -->
                    <div>
                        <h1 class="text-3xl font-bold font-display text-gray-900 dark:text-white mb-4">
                            ${blog.title}
                        </h1>
                        <div class="flex flex-wrap items-center gap-4 text-sm text-gray-600 dark:text-gray-400">
                            <div class="flex items-center gap-2">
                                <span class="material-symbols-outlined text-sm">person</span>
                                <span>${blog.authorName || 'Unknown Author'}</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="material-symbols-outlined text-sm">category</span>
                                <span class="capitalize">${blog.category}</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="material-symbols-outlined text-sm">schedule</span>
                                <span>${blog.readTime || 5} min read</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="material-symbols-outlined text-sm">${blog.isPublished ? 'check_circle' : 'edit_note'}</span>
                                <span>${blog.isPublished ? 'Published' : 'Draft'}</span>
                            </div>
                            ${blog.isFeatured ? `
                                <div class="flex items-center gap-2 text-yellow-600">
                                    <span class="material-symbols-outlined text-sm">star</span>
                                    <span>Featured</span>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                    
                    <!-- Dates -->
                    <div class="flex gap-6 text-xs text-gray-500 dark:text-gray-400">
                        <div>
                            <span class="font-semibold">Created:</span> ${createdDate}
                        </div>
                        <div>
                            <span class="font-semibold">Published:</span> ${publishedDate}
                        </div>
                    </div>
                    
                    <!-- Tags -->
                    <div>
                        <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Tags:</h3>
                        <div class="flex flex-wrap gap-2">
                            ${tagsHTML}
                        </div>
                    </div>
                    
                    <!-- Excerpt -->
                    <div class="bg-gray-50 dark:bg-gray-800 rounded-xl p-4">
                        <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Excerpt:</h3>
                        <p class="text-gray-600 dark:text-gray-400 italic">${blog.excerpt || 'No excerpt'}</p>
                    </div>
                    
                    <!-- Full Content -->
                    <div>
                        <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Content:</h3>
                        <div class="prose dark:prose-invert max-w-none text-gray-700 dark:text-gray-300 leading-relaxed bg-white dark:bg-gray-900 p-4 rounded-lg border border-gray-200 dark:border-gray-700">
                            ${blog.content && blog.content.trim() !== ''
                    ? blog.content.replace(/\n/g, '<br>')
                    : '<p class="text-gray-500 italic">No content available</p>'}
                        </div>
                    </div>
                    
                    <!-- URL Slug Info -->
                    <div class="border-t border-gray-200 dark:border-gray-700 pt-4 text-xs text-gray-500">
                        <span class="font-semibold">URL Slug:</span> <code class="bg-gray-100 dark:bg-gray-800 px-2 py-1 rounded">${blog.slug}</code>
                    </div>
                </div>
            `;

            document.getElementById('viewContent').innerHTML = viewHTML;
            document.getElementById('viewTitle').textContent = blog.title;
            document.getElementById('blogViewModal').classList.remove('hidden');
        }

        // Edit blog
        function editBlog(blog) {
            console.log('EditBlog called with:', blog);
            console.log('Content to populate:', blog.content);

            document.getElementById('blogId').value = blog.id;
            document.getElementById('blogTitle').value = blog.title;
            document.getElementById('blogSlug').value = blog.slug;
            document.getElementById('blogSlug').dataset.userEdited = 'true';
            document.getElementById('blogCategory').value = blog.category;
            document.getElementById('blogAuthor').value = blog.authorName || '';
            document.getElementById('blogTags').value = blog.tags ? blog.tags.map(t => t.name || t).join(', ') : '';
            document.getElementById('blogImage').value = blog.featuredImage || '';
            document.getElementById('blogExcerpt').value = blog.excerpt || '';
            document.getElementById('blogContent').value = blog.content || '';

            console.log('Content field value after set:', document.getElementById('blogContent').value);

            // Set publish status
            const isPublished = blog.isPublished;
            document.querySelector(`input[name="isPublished"][value="${isPublished}"]`).checked = true;

            // Set featured status
            document.getElementById('blogFeatured').checked = blog.isFeatured || false;

            // Apply font style class
            const contentField = document.getElementById('blogContent');
            Object.values(fontStyles).forEach(style => {
                contentField.classList.remove(style.class);
            });
            contentField.classList.add(fontStyles[currentFontStyle].class);

            // Update image preview
            if (blog.featuredImage) {
                updateImagePreview();
            }

            // Update modal title
            document.getElementById('formTitle').textContent = 'Edit Blog';

            // Show modal
            document.getElementById('blogFormModal').classList.remove('hidden');
        }

        // Delete blog
        async function deleteBlog(blogId, blogTitle) {
            if (!confirm(`Are you sure you want to delete "${blogTitle}"? This action cannot be undone.`)) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/blogs/${blogId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error('Failed to delete blog');
                }

                showMessage('Blog deleted successfully!', 'check_circle', 'green');
                loadBlogs();
            } catch (error) {
                console.error('Error deleting blog:', error);
                showMessage('Error deleting blog: ' + error.message, 'error', 'red');
            }
        }

        // Form submission
        document.getElementById('blogForm')?.addEventListener('submit', async function (e) {
            e.preventDefault();

            const formData = new FormData(this);
            const blogId = document.getElementById('blogId').value;

            const blogData = {
                title: formData.get('title').trim(),
                slug: formData.get('slug').trim() || generateSlug(formData.get('title')),
                category: formData.get('category'),
                authorName: formData.get('authorName').trim(),
                tags: formData.get('tags') ? formData.get('tags').split(',').map(t => t.trim()).filter(t => t) : [],
                featuredImage: formData.get('featuredImage').trim() || undefined,
                excerpt: formData.get('excerpt').trim(),
                content: formData.get('content').trim(),
                isPublished: formData.get('isPublished') === 'true',
                isFeatured: document.getElementById('blogFeatured').checked
            };

            try {
                let response;
                if (blogId) {
                    // Update existing blog
                    response = await fetch(`${API_BASE_URL}/blogs/${blogId}`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${authToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(blogData)
                    });
                } else {
                    // Create new blog
                    response = await fetch(`${API_BASE_URL}/blogs`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${authToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(blogData)
                    });
                }

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.message || 'Failed to save blog');
                }

                const result = await response.json();
                showMessage(blogId ? 'Blog updated successfully!' : 'Blog created successfully!', 'check_circle', 'green');

                // Close modal and reset form
                document.getElementById('blogFormModal').classList.add('hidden');
                this.reset();
                document.getElementById('blogId').value = '';
                document.getElementById('blogSlug').dataset.userEdited = '';

                // Reload blogs
                loadBlogs();
            } catch (error) {
                console.error('Error saving blog:', error);
                showMessage('Error: ' + error.message, 'error', 'red');
            }
        });

        // Modal controls
        document.getElementById('createNewBtn')?.addEventListener('click', function () {
            document.getElementById('blogForm').reset();
            document.getElementById('blogId').value = '';
            document.getElementById('blogSlug').dataset.userEdited = '';
            document.getElementById('formTitle').textContent = '‚ú® Create Your Blog';

            // Reset design panel
            document.getElementById('layoutSelect').value = '';
            document.getElementById('fontStyle').value = 'formal';
            currentLayout = '';
            currentFontStyle = 'formal';
            currentColorScheme = 'purple';

            // Reset image
            document.getElementById('imageUpload').value = '';
            document.getElementById('blogImage').value = '';
            document.getElementById('imagePreviewContainer').classList.add('hidden');
            uploadedImageData = null;

            // Apply initial font style
            const contentField = document.getElementById('blogContent');
            Object.values(fontStyles).forEach(style => {
                contentField.classList.remove(style.class);
            });
            contentField.classList.add(fontStyles['formal'].class);
            contentField.style.borderColor = '#e5e7eb';
            contentField.style.boxShadow = 'none';

            document.getElementById('blogFormModal').classList.remove('hidden');
        });

        document.getElementById('closeModal')?.addEventListener('click', function () {
            document.getElementById('blogFormModal').classList.add('hidden');
        });

        document.getElementById('clearForm')?.addEventListener('click', function () {
            document.getElementById('blogForm').reset();
            document.getElementById('blogId').value = '';
            document.getElementById('blogSlug').dataset.userEdited = '';
        });

        document.getElementById('refreshBlogs')?.addEventListener('click', function () {
            loadBlogs();
        });

        // Blog Form Modal - Close when clicking outside
        document.getElementById('blogFormModal')?.addEventListener('click', function (e) {
            if (e.target === this) {
                this.classList.add('hidden');
            }
        });

        // Blog View Modal - Close button
        document.getElementById('closeViewModal')?.addEventListener('click', function () {
            document.getElementById('blogViewModal').classList.add('hidden');
        });

        // Blog View Modal - Close when clicking outside
        document.getElementById('blogViewModal')?.addEventListener('click', function (e) {
            if (e.target === this) {
                this.classList.add('hidden');
            }
        });

        // Edit from View Modal
        document.getElementById('editFromView')?.addEventListener('click', function () {
            if (currentViewingBlog) {
                document.getElementById('blogViewModal').classList.add('hidden');
                editBlog(currentViewingBlog);
            }
        });

        // Make functions global
        window.viewBlog = viewBlog;
        window.editBlog = editBlog;
        window.deleteBlog = deleteBlog;

        // ==========================================
        // BLOG BUILDER INITIALIZATION
        // ==========================================

        let builderInitialized = false;

        /**
         * Initialize Blog Builder
         */
        function initializeBlogBuilder() {
            if (builderInitialized) return;

            console.log('üöÄ Initializing Blog Builder...');

            try {
                builderInitialized = true;

                const canvasContainer = document.getElementById('builderCanvasContainer');
                const toolsPanel = document.querySelector('[id="fontColorPicker"]')?.closest('.w-64'); // Left sidebar

                if (!canvasContainer) {
                    console.error('‚ùå Canvas container not found!');
                    return;
                }

                console.log('‚úÖ Canvas container found');

                // Initialize canvas
                CanvasManager.init(canvasContainer);
                console.log('‚úÖ Canvas Manager initialized');

                // Initialize design tools
                const buildArea = document.querySelector('.flex-1.flex.flex-col');
                if (buildArea) {
                    DesignToolsManager.init(buildArea);
                    console.log('‚úÖ Design Tools initialized');
                }

                // Setup undo/redo listener
                UndoRedoManager.addListener((state) => {
                    const undoBtn = document.getElementById('undoBtn');
                    const redoBtn = document.getElementById('redoBtn');
                    if (undoBtn) undoBtn.disabled = !state.canUndo;
                    if (redoBtn) redoBtn.disabled = !state.canRedo;
                });
                console.log('‚úÖ Undo/Redo listener added');

                // Setup auto-save listener
                AutoSaveManager.addListener((event) => {
                    const indicator = document.getElementById('autoSaveIndicator');
                    if (indicator) {
                        if (event.saved) {
                            indicator.textContent = '‚úì Saved';
                            indicator.classList.add('text-green-600');
                            setTimeout(() => {
                                indicator.textContent = '‚Ä¢ Auto-saving...';
                                indicator.classList.remove('text-green-600');
                            }, 2000);
                        }
                    }
                });
                console.log('‚úÖ Auto-save listener added');

                // Setup button event listeners
                setupBuilderButtonListeners();
                console.log('‚úÖ Button listeners setup');

                // Load auto-saved data if exists
                const savedData = AutoSaveManager.load();
                if (savedData && savedData.elements && savedData.elements.length > 0) {
                    setTimeout(() => {
                        CanvasManager.render();
                        BuilderUtils.showToast('Previous work restored', 'info');
                        console.log('‚úÖ Previous work restored');
                    }, 200);
                }

                console.log('üéâ Blog Builder fully initialized!');
            } catch (error) {
                console.error('‚ùå Error initializing Blog Builder:', error);
                BuilderUtils.showToast('Error initializing builder: ' + error.message, 'error');
            }
        }

        /**
         * Setup builder button event listeners
         */
        function setupBuilderButtonListeners() {
            // Undo button
            document.getElementById('undoBtn')?.addEventListener('click', (e) => {
                e.preventDefault();
                UndoRedoManager.undo();
                CanvasManager.render();
            });

            // Redo button
            document.getElementById('redoBtn')?.addEventListener('click', (e) => {
                e.preventDefault();
                UndoRedoManager.redo();
                CanvasManager.render();
            });

            // Preview button
            document.getElementById('previewBtn')?.addEventListener('click', (e) => {
                e.preventDefault();
                const metadata = getBuilderMetadata();
                const html = ExportEngine.generateCompleteBlogHTML(ElementManager.getElementsData(), metadata);

                const previewWindow = window.open('', 'BlogPreview', 'width=900,height=700');
                previewWindow.document.write(html);
                previewWindow.document.close();
            });

            // Save button
            document.getElementById('saveBtn')?.addEventListener('click', async (e) => {
                e.preventDefault();
                await saveBlogFromBuilder();
            });

            // Clear canvas button
            document.getElementById('clearCanvasBtn')?.addEventListener('click', (e) => {
                e.preventDefault();
                if (confirm('Clear all elements from canvas? This cannot be undone!')) {
                    CanvasManager.clear();
                    UndoRedoManager.clear();
                    BuilderUtils.showToast('Canvas cleared', 'info');
                }
            });

            // Close modal
            document.getElementById('closeModal')?.addEventListener('click', (e) => {
                e.preventDefault();
                if (confirm('Close without saving? Any unsaved changes will be lost.')) {
                    document.getElementById('blogFormModal').classList.add('hidden');
                    CanvasManager.clear();
                    UndoRedoManager.clear();
                }
            });
        }

        /**
         * Get metadata from sidebar inputs
         */
        function getBuilderMetadata() {
            return {
                title: document.getElementById('blogTitle').value,
                slug: document.getElementById('blogSlug').value || BuilderUtils.generateSlug(document.getElementById('blogTitle').value),
                category: document.getElementById('blogCategory').value,
                authorName: document.getElementById('blogAuthor').value,
                tags: document.getElementById('blogTags').value.split(',').map(t => t.trim()).filter(t => t),
                excerpt: document.getElementById('blogExcerpt').value,
                isPublished: document.getElementById('blogPublished').checked,
                isFeatured: document.getElementById('blogFeatured').checked,
                featuredImage: '' // TODO: add featured image input
            };
        }

        /**
         * Save blog from builder
         */
        async function saveBlogFromBuilder() {
            const metadata = getBuilderMetadata();
            const blogId = document.getElementById('blogId').value;
            const token = localStorage.getItem('authToken') || authToken;

            // Validate required fields
            if (!metadata.title || !metadata.category || !metadata.authorName) {
                BuilderUtils.showToast('Please fill in title, category, and author', 'error');
                return;
            }

            // Validate token
            if (!token) {
                BuilderUtils.showToast('Not authenticated. Please login first.', 'error');
                return;
            }

            // Generate content from canvas
            const content = ExportEngine.exportToHTML(ElementManager.getElementsData());

            const blogData = {
                title: metadata.title,
                slug: metadata.slug,
                category: metadata.category,
                authorName: metadata.authorName,
                tags: metadata.tags,
                excerpt: metadata.excerpt || metadata.title.substring(0, 100),
                content: content,
                isPublished: metadata.isPublished,
                isFeatured: metadata.isFeatured,
                featuredImage: metadata.featuredImage
            };

            try {
                const saveBtn = document.getElementById('saveBtn');
                saveBtn.disabled = true;
                saveBtn.innerHTML = '<span class="material-symbols-outlined">hourglass_empty</span> Saving...';

                let response;
                if (blogId) {
                    // Update existing
                    response = await fetch(`${API_BASE_URL}/blogs/${blogId}`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(blogData)
                    });
                } else {
                    // Create new
                    response = await fetch(`${API_BASE_URL}/blogs`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(blogData)
                    });
                }

                if (!response.ok) {
                    throw new Error('Failed to save blog');
                }

                BuilderUtils.showToast(blogId ? 'Blog updated!' : 'Blog created!', 'success');
                AutoSaveManager.clear();
                document.getElementById('blogFormModal').classList.add('hidden');
                CanvasManager.clear();
                UndoRedoManager.clear();
                loadBlogs();

            } catch (error) {
                console.error('Error saving blog:', error);
                BuilderUtils.showToast('Error: ' + error.message, 'error');
            } finally {
                const saveBtn = document.getElementById('saveBtn');
                saveBtn.disabled = false;
                saveBtn.innerHTML = '<span class="material-symbols-outlined">save</span> Save Blog';
            }
        }

        /**
         * Open blog builder
         */
        function openBlogBuilder(blogData = null) {
            console.log('üé® Opening Blog Builder...');

            // Check if builder scripts are loaded
            if (!window.CanvasManager) {
                console.error('‚ùå CanvasManager not loaded. Check if blog-builder scripts are available.');
                BuilderUtils?.showToast('Builder scripts not loaded. Please refresh the page.', 'error') || alert('Builder scripts not loaded');
                return;
            }

            if (!document.getElementById('blogFormModal')) {
                console.error('‚ùå Blog Form Modal not found in DOM');
                return;
            }

            initializeBlogBuilder();

            // Reset builder
            CanvasManager.clear();
            UndoRedoManager.clear();
            AutoSaveManager.forceSave();

            // Set metadata
            document.getElementById('blogId').value = blogData?.id || '';
            document.getElementById('blogTitle').value = blogData?.title || '';
            document.getElementById('blogSlug').value = blogData?.slug || '';
            document.getElementById('blogCategory').value = blogData?.category || '';
            document.getElementById('blogAuthor').value = blogData?.authorName || '';
            document.getElementById('blogExcerpt').value = blogData?.excerpt || '';
            document.getElementById('blogTags').value = (blogData?.tags || []).join(', ');
            document.getElementById('blogPublished').checked = blogData?.isPublished || false;
            document.getElementById('blogFeatured').checked = blogData?.isFeatured || false;

            if (blogData) {
                document.getElementById('formTitle').textContent = '‚úé Edit Blog';
            } else {
                document.getElementById('formTitle').textContent = '‚ú® Create New Blog';
            }

            document.getElementById('blogFormModal').classList.remove('hidden');

            // Render canvas
            setTimeout(() => {
                CanvasManager.render();
                console.log('‚úÖ Canvas rendered');
            }, 100);
        }

        // Update create new button
        function attachCreateBlogHandler() {
            const createBtn = document.getElementById('createNewBtn');
            if (createBtn) {
                console.log('‚úÖ Create blog button found, attaching handler');
                createBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    console.log('üé¨ Create New Blog clicked');
                    openBlogBuilder();
                });
            } else {
                console.warn('‚ö†Ô∏è Create blog button not found');
            }
        }

        // Update edit blog function
        const originalEditBlog = window.editBlog;
        window.editBlog = function(blog) {
            console.log('üìù Editing blog:', blog);
            openBlogBuilder(blog);
        };

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function () {
            console.log('üìÑ Page loaded, loading blogs...');
            loadBlogs();
            console.log('‚úÖ Attaching create blog button handler');
            attachCreateBlogHandler();
        });

        // Also attach in a setTimeout to be safe
        setTimeout(() => {
            attachCreateBlogHandler();
        }, 500);
    </script>

    <div id="footer-placeholder"></div>
</body>

</html>