<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Apply for Education Loan - LoanHero</title>

    <!-- Meta Tags -->
    <meta name="description"
        content="Apply for transparent, flexible, and accessible education loans for your global journey." />

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Serif:ital,wght@0,100..900;1,100..900&family=Noto+Sans:ital,wght@0,100..900;1,100..900&display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet" />
    <link href="assets/css/main.css" rel="stylesheet" />

    <!-- Styles & Config -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#6605c7",
                        "background-light": "#f7f5f8",
                        "background-dark": "#190f23",
                        "gold-accent": "#e0c389",
                    },
                    fontFamily: {
                        "display": ["'Noto Serif'", "serif"],
                        "sans": ["'Noto Sans'", "sans-serif"],
                    },
                    backgroundImage: {
                        'mesh-gradient': 'radial-gradient(at 0% 0%, rgba(102, 5, 199, 0.4) 0px, transparent 50%), radial-gradient(at 100% 0%, rgba(224, 195, 137, 0.5) 0px, transparent 50%), radial-gradient(at 100% 100%, rgba(139, 192, 232, 0.4) 0px, transparent 50%), radial-gradient(at 0% 100%, rgba(102, 5, 199, 0.3) 0px, transparent 50%)',
                    }
                },
            },
        };
    </script>
    <style>
        body {
            background-attachment: fixed;
        }
    </style>
</head>

<body
    class="bg-background-light dark:bg-background-dark min-h-screen font-sans transition-colors duration-500 text-gray-900 dark:text-gray-100 relative">

    <!-- Background Structure -->
    <div class="fixed inset-0 z-0 bg-background-light dark:bg-background-dark pointer-events-none">
        <div class="absolute inset-0 bg-mesh-gradient opacity-90"></div>
        <div class="absolute inset-0 opacity-30 mix-blend-overlay"
            style="background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuCSQJcRexkqlKu3kzwZCWIGdx9mSdhvK4Je6lxA9kVrWHQFg-ShCu6j3XLipgBh0waP45VYm3rBVD2Psy-FTMp2qLU946EXQwD2sIGZJLe5tw2ugWPYnnOTMWoTGM95X4u1epiDmYaEV_vVdH7tyv2ZlDuFjSMZlzWulHW3UyesMipUWi30MryHEiz-_Lje83ApXK-FpMUQdIEWe0M_ZFfiu3BcH1_opus8b5qOTiMh8tMBAX7ifzSLR_qpWnWtdB8obUzknDxLtfeP');">
        </div>
    </div>

    <!-- Navigation -->
    <div id="navbar-placeholder"></div>

    <main class="relative z-10 pt-32 pb-24">
        <section class="max-w-4xl mx-auto px-6">
            <div class="text-center mb-16">
                <h1 class="text-5xl md:text-6xl font-bold font-display mb-6 text-gray-900 dark:text-white">
                    Apply for <span class="text-primary italic">Education Loan</span>
                </h1>
                <p class="text-xl text-gray-500 dark:text-gray-400 max-w-2xl mx-auto leading-relaxed font-sans">
                    Take the first step towards your dream education. Fill out the details below to get started.
                </p>
            </div>

            <div class="glass-card rounded-3xl p-8 md:p-12 shadow-xl">
                <form id="loanApplicationForm" class="space-y-8">
                    <!-- Personal Details -->
                    <h3 class="text-xl font-bold text-gray-800 dark:text-gray-200 border-b pb-2">Personal Details</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">First Name
                                *</label>
                            <input type="text" id="firstName" required pattern="[A-Za-z\s]+"
                                title="Only alphabets are allowed"
                                class="w-full rounded-xl border-gray-200 dark:border-zinc-700 bg-white/50 dark:bg-zinc-800/50 focus:border-primary focus:ring-primary px-4 py-3"
                                placeholder="Enter your first name">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">Last Name
                                *</label>
                            <input type="text" id="lastName" required pattern="[A-Za-z\s]+"
                                title="Only alphabets are allowed"
                                class="w-full rounded-xl border-gray-200 dark:border-zinc-700 bg-white/50 dark:bg-zinc-800/50 focus:border-primary focus:ring-primary px-4 py-3"
                                placeholder="Enter your last name">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">Email Address
                                *</label>
                            <input type="email" id="email" required
                                class="w-full rounded-xl border-gray-200 dark:border-zinc-700 bg-white/50 dark:bg-zinc-800/50 focus:border-primary focus:ring-primary px-4 py-3"
                                placeholder="your.email@example.com">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">Phone Number
                                *</label>
                            <input type="tel" id="phone" required pattern="[0-9]{10}"
                                title="Please enter a valid 10-digit phone number"
                                class="w-full rounded-xl border-gray-200 dark:border-zinc-700 bg-white/50 dark:bg-zinc-800/50 focus:border-primary focus:ring-primary px-4 py-3"
                                placeholder="9876543210">
                        </div>
                    </div>

                    <!-- Loan Details -->
                    <h3 class="text-xl font-bold text-gray-800 dark:text-gray-200 border-b pb-2">Loan Details</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">Preferred Bank
                                *</label>
                            <input type="text" id="bankName" required
                                class="w-full rounded-xl border-gray-200 dark:border-zinc-700 bg-white/50 dark:bg-zinc-800/50 focus:border-primary focus:ring-primary px-4 py-3"
                                placeholder="Enter preferred bank name">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">Loan Type
                                *</label>
                            <input type="text" id="loanType" value="Education Loan" readonly
                                class="w-full rounded-xl border-gray-200 dark:border-zinc-700 bg-gray-100 dark:bg-zinc-900 cursor-not-allowed text-gray-500 focus:border-primary focus:ring-primary px-4 py-3">
                        </div>
                    </div>

                    <!-- Parent Details -->
                    <h3 class="text-xl font-bold text-gray-800 dark:text-gray-200 border-b pb-2">Parent Details</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">Father's Name
                                *</label>
                            <input type="text" id="fatherName" required pattern="[A-Za-z\s]+"
                                title="Only alphabets are allowed"
                                class="w-full rounded-xl border-gray-200 dark:border-zinc-700 bg-white/50 dark:bg-zinc-800/50 focus:border-primary focus:ring-primary px-4 py-3"
                                placeholder="Father's Name">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">Father's Phone
                                *</label>
                            <input type="tel" id="fatherPhone" required pattern="[0-9]{10}"
                                title="Please enter a valid 10-digit phone number"
                                class="w-full rounded-xl border-gray-200 dark:border-zinc-700 bg-white/50 dark:bg-zinc-800/50 focus:border-primary focus:ring-primary px-4 py-3"
                                placeholder="Father's Phone">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">Father's Email
                                *</label>
                            <input type="email" id="fatherEmail" required
                                class="w-full rounded-xl border-gray-200 dark:border-zinc-700 bg-white/50 dark:bg-zinc-800/50 focus:border-primary focus:ring-primary px-4 py-3"
                                placeholder="Father's Email">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">Mother's Name
                                *</label>
                            <input type="text" id="motherName" required pattern="[A-Za-z\s]+"
                                title="Only alphabets are allowed"
                                class="w-full rounded-xl border-gray-200 dark:border-zinc-700 bg-white/50 dark:bg-zinc-800/50 focus:border-primary focus:ring-primary px-4 py-3"
                                placeholder="Mother's Name">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">Mother's Phone
                                *</label>
                            <input type="tel" id="motherPhone" required pattern="[0-9]{10}"
                                title="Please enter a valid 10-digit phone number"
                                class="w-full rounded-xl border-gray-200 dark:border-zinc-700 bg-white/50 dark:bg-zinc-800/50 focus:border-primary focus:ring-primary px-4 py-3"
                                placeholder="Mother's Phone">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">Mother's Email
                                *</label>
                            <input type="email" id="motherEmail" required
                                class="w-full rounded-xl border-gray-200 dark:border-zinc-700 bg-white/50 dark:bg-zinc-800/50 focus:border-primary focus:ring-primary px-4 py-3"
                                placeholder="Mother's Email">
                        </div>
                    </div>

                    <!-- Collateral -->
                    <h3 class="text-xl font-bold text-gray-800 dark:text-gray-200 border-b pb-2">Collateral Information
                    </h3>
                    <div>
                        <label class="inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="hasCollateral"
                                class="form-checkbox h-5 w-5 text-primary rounded border-gray-300 focus:ring-primary transition duration-150 ease-in-out">
                            <span class="ml-2 text-gray-700 dark:text-gray-300 font-medium">Do you have
                                collateral?</span>
                        </label>
                    </div>
                    <div id="collateralSection" class="hidden animate-fade-in-down transition-all duration-300">
                        <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">Collateral Details
                            *</label>
                        <textarea id="collateralDetails" rows="3"
                            class="w-full rounded-xl border-gray-200 dark:border-zinc-700 bg-white/50 dark:bg-zinc-800/50 focus:border-primary focus:ring-primary px-4 py-3"
                            placeholder="Describe your collateral (e.g., Property type, location, estimated value)"></textarea>
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">Target
                            University</label>
                        <input type="text" id="university"
                            class="w-full rounded-xl border-gray-200 dark:border-zinc-700 bg-white/50 dark:bg-zinc-800/50 focus:border-primary focus:ring-primary px-4 py-3"
                            placeholder="University name">
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">Desired Loan Amount
                            (₹) *</label>
                        <div class="relative">
                            <span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 font-bold">₹</span>
                            <input type="number" id="loanAmount" required min="10000"
                                class="w-full rounded-xl border-gray-200 dark:border-zinc-700 bg-white/50 dark:bg-zinc-800/50 pl-8 focus:border-primary focus:ring-primary px-4 py-3"
                                placeholder="500000">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">Course Details /
                            Purpose</label>
                        <textarea id="courseDetails" rows="4"
                            class="w-full rounded-xl border-gray-200 dark:border-zinc-700 bg-white/50 dark:bg-zinc-800/50 focus:border-primary focus:ring-primary px-4 py-3"
                            placeholder="Briefly describe the course you are applying for..."></textarea>
                    </div>

                    <div class="pt-4">
                        <button type="submit" id="submitBtn"
                            class="w-full py-4 bg-primary text-white font-bold rounded-xl hover:bg-primary/90 transition-colors shadow-lg shadow-primary/20 uppercase tracking-widest text-sm">
                            Submit Application
                        </button>
                    </div>
                </form>
            </div>
        </section>
    </main>

    <div id="footer-placeholder"></div>

    <!-- Success Modal -->
    <div id="successModal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm"></div>
        <div
            class="relative bg-white dark:bg-zinc-900 rounded-3xl shadow-2xl w-full max-w-md p-8 text-center animate-bounce-in">
            <div
                class="w-20 h-20 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-6">
                <span class="material-symbols-outlined text-5xl text-green-600">check_circle</span>
            </div>
            <h2 class="text-2xl font-bold font-display mb-4 text-gray-900 dark:text-white">Application Submitted!</h2>
            <p class="text-gray-500 dark:text-gray-400 mb-6">Your loan application has been submitted successfully. You
                can track its status from your applications page.</p>
            <div class="flex gap-3">
                <a href="my-applications.html"
                    class="flex-1 inline-block px-8 py-3 bg-primary text-white font-bold rounded-full hover:bg-primary/90 transition-all">
                    View My Applications
                </a>
                <a href="dashboard.html"
                    class="flex-1 inline-block px-8 py-3 bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-white font-bold rounded-full hover:bg-gray-300 dark:hover:bg-gray-600 transition-all">
                    Go to Dashboard
                </a>
            </div>
        </div>
    </div>

    <style>
        @keyframes bounce-in {
            0% {
                opacity: 0;
                transform: scale(0.8);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        .animate-bounce-in {
            animation: bounce-in 0.4s ease-out forwards;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translate3d(0, -20px, 0);
            }

            to {
                opacity: 1;
                transform: translate3d(0, 0, 0);
            }
        }

        .animate-fade-in-down {
            animation: fadeInDown 0.3s ease-out;
        }
    </style>

    <script>
        const API_URL = 'http://localhost:3000';

        // Collateral toggle
        document.getElementById('hasCollateral').addEventListener('change', function () {
            const section = document.getElementById('collateralSection');
            const details = document.getElementById('collateralDetails');
            if (this.checked) {
                section.classList.remove('hidden');
                details.required = true;
            } else {
                section.classList.add('hidden');
                details.required = false;
                details.value = '';
            }
        });

        // Form submission handler
        document.getElementById('loanApplicationForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';

            // Get user info from localStorage
            const userId = localStorage.getItem('userId');
            const accessToken = localStorage.getItem('accessToken');
            const userEmail = localStorage.getItem('userEmail');

            if (!userId || !accessToken || !userEmail) {
                alert('You must be logged in to submit an application');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Application';
                window.location.href = 'login.html';
                return;
            }

            // Gather form data
            const loanType = 'education'; // Hardcoded
            const bank = document.getElementById('bankName').value;
            const amount = parseFloat(document.getElementById('loanAmount').value);
            const purpose = document.getElementById('courseDetails').value;

            // New fields
            const firstName = document.getElementById('firstName').value;
            const lastName = document.getElementById('lastName').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            const fatherName = document.getElementById('fatherName').value;
            const fatherPhone = document.getElementById('fatherPhone').value;
            const fatherEmail = document.getElementById('fatherEmail').value;
            const motherName = document.getElementById('motherName').value;
            const motherPhone = document.getElementById('motherPhone').value;
            const motherEmail = document.getElementById('motherEmail').value;

            const hasCollateral = document.getElementById('hasCollateral').checked;
            const collateralDetails = document.getElementById('collateralDetails').value;
            const university = document.getElementById('university').value;

            try {
                // Call backend API to create application
                const response = await fetch(`${API_URL}/auth/create-application`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${accessToken}`
                    },
                    body: JSON.stringify({
                        userId,
                        firstName,
                        lastName,
                        email,
                        phone,
                        bank,
                        loanType,
                        amount,
                        purpose,
                        universityName: university,
                        fatherName, fatherPhone, fatherEmail,
                        motherName, motherPhone, motherEmail,
                        hasCollateral, collateralDetails
                    })
                });

                const data = await response.json();

                if (!response.ok || !data.success) {
                    throw new Error(data.message || 'Failed to submit application');
                }

                // Build local application object for caching
                const application = {
                    id: data.application.id,
                    userId: data.application.userId,
                    firstName: document.getElementById('firstName').value,
                    lastName: document.getElementById('lastName').value,
                    email: userEmail,
                    phone: document.getElementById('phone').value,
                    bank: data.application.bank,
                    type: data.application.loanType,
                    university: document.getElementById('university').value,
                    amount: data.application.amount,
                    purpose: data.application.purpose,
                    status: data.application.status || 'pending',
                    date: data.application.date || new Date().toISOString()
                };

                // Load existing dashboard data
                let dashboardData = JSON.parse(localStorage.getItem('dashboardData')) || {
                    applications: [],
                    documents: {
                        aadhar: { uploaded: false, status: 'pending' },
                        pan: { uploaded: false, status: 'pending' },
                        passport: { uploaded: false, status: 'pending' },
                        '10th': { uploaded: false, status: 'pending' },
                        '12th': { uploaded: false, status: 'pending' },
                        degree: { uploaded: false, status: 'pending' },
                    },
                    activity: []
                };

                // Ensure arrays exist and are arrays
                if (!Array.isArray(dashboardData.applications)) {
                    dashboardData.applications = [];
                }
                if (!Array.isArray(dashboardData.activity)) {
                    dashboardData.activity = [];
                }
                if (!dashboardData.documents || typeof dashboardData.documents !== 'object') {
                    dashboardData.documents = {
                        aadhar: { uploaded: false, status: 'pending' },
                        pan: { uploaded: false, status: 'pending' },
                        passport: { uploaded: false, status: 'pending' },
                        '10th': { uploaded: false, status: 'pending' },
                        '12th': { uploaded: false, status: 'pending' },
                        degree: { uploaded: false, status: 'pending' },
                    };
                }

                // Add new application
                dashboardData.applications.unshift(application);

                // Add activity log
                dashboardData.activity.unshift({
                    type: 'new_application',
                    description: `New ${formatLoanType(application.type)} application submitted to ${application.bank}`,
                    amount: application.amount,
                    date: new Date().toISOString()
                });

                // Save to localStorage
                localStorage.setItem('dashboardData', JSON.stringify(dashboardData));

                // Show success modal after a short delay
                setTimeout(() => {
                    document.getElementById('successModal').classList.remove('hidden');
                }, 500);
            } catch (error) {
                console.error('Error submitting application:', error);
                alert('Error submitting application: ' + error.message);
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Application';
            }
        });

        function formatLoanType(type) {
            const types = {
                education: 'Education Loan',
                home: 'Home Loan',
                personal: 'Personal Loan',
                business: 'Business Loan',
                vehicle: 'Vehicle Loan'
            };
            return types[type] || type;
        }
    </script>
    <script src="assets/js/auth.js"></script>
    <script src="assets/js/components-loader.js"></script>
</body>

</html>