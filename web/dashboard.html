<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Dashboard - LoanHero</title>

    <!-- Meta Tags -->
    <meta name="description" content="Manage your loan applications and view your progress." />

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Serif:ital,wght@0,100..900;1,100..900&family=Noto+Sans:ital,wght@0,100..900;1,100..900&display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet" />
    <link href="assets/css/main.css" rel="stylesheet" />

    <!-- Styles & Config -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#6605c7",
                        "background-light": "#f7f5f8",
                        "background-dark": "#190f23",
                        "gold-accent": "#e0c389",
                    },
                    fontFamily: {
                        "display": ["'Noto Serif'", "serif"],
                        "sans": ["'Noto Sans'", "sans-serif"],
                    },
                    backgroundImage: {
                        'mesh-gradient': 'radial-gradient(at 0% 0%, rgba(102, 5, 199, 0.4) 0px, transparent 50%), radial-gradient(at 100% 0%, rgba(224, 195, 137, 0.5) 0px, transparent 50%), radial-gradient(at 100% 100%, rgba(139, 192, 232, 0.4) 0px, transparent 50%), radial-gradient(at 0% 100%, rgba(102, 5, 199, 0.3) 0px, transparent 50%)',
                    }
                },
            },
        };
    </script>
    <style>
        body {
            background-attachment: fixed;
        }

        /* Activity item animation */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .activity-item {
            animation: slideIn 0.3s ease-out forwards;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.07);
        }

        .dark .glass-card {
            background: rgba(25, 15, 35, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
    </style>
</head>

<body
    class="bg-background-light dark:bg-background-dark min-h-screen font-sans transition-colors duration-500 text-gray-900 dark:text-gray-100 relative">

    <!-- Background Structure -->
    <div class="fixed inset-0 z-0 bg-background-light dark:bg-background-dark pointer-events-none overflow-hidden">
        <div class="absolute inset-0 bg-mesh-gradient opacity-90"></div>
        <div class="absolute inset-0 opacity-30 mix-blend-overlay"
            style="background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuCSQJcRexkqlKu3kzwZCWIGdx9mSdhvK4Je6lxA9kVrWHQFg-ShCu6j3XLipgBh0waP45VYm3rBVD2Psy-FTMp2qLU946EXQwD2sIGZJLe5tw2ugWPYnnOTMWoTGM95X4u1epiDmYaEV_vVdH7tyv2ZlDuFjSMZlzWulHW3UyesMipUWi30MryHEiz-_Lje83ApXK-FpMUQdIEWe0M_ZFfiu3BcH1_opus8b5qOTiMh8tMBAX7ifzSLR_qpWnWtdB8obUzknDxLtfeP');">
        </div>
    </div>

    <!-- Navigation -->
    <div id="navbar-placeholder"></div>

    <main class="relative z-10 pt-32 pb-24 px-6 max-w-7xl mx-auto">
        <!-- Header -->
        <div class="flex flex-col md:flex-row justify-between items-start md:items-end gap-4 mb-12">
            <div>
                <h1 id="welcomeText" class="text-4xl font-bold font-display mb-2">Welcome back!</h1>
                <p class="text-gray-500 dark:text-gray-400">Here's an overview of your loan applications.</p>
            </div>
            <a href="apply-loan.html"
                class="px-8 py-3 bg-primary text-white font-bold rounded-full hover:bg-background-light/90 transition-all shadow-lg shadow-primary/20 flex items-center gap-2">
                <span class="material-symbols-outlined">add</span>
                New Application
            </a>
        </div>

        <!-- Application Progress Tracker -->
        <div class="glass-card rounded-3xl p-8 mb-12" id="progressTrackerCard">
            <div class="flex items-center justify-between mb-8">
                <div>
                    <h2 class="text-2xl font-bold">Application Progress</h2>
                    <p class="text-sm text-gray-500 dark:text-gray-400">Track your loan application journey</p>
                </div>
                <span id="progressPercentage" class="text-2xl font-bold text-primary">0%</span>
            </div>

            <!-- Progress Steps -->
            <div class="relative">
                <div class="absolute top-6 left-6 right-6 h-1 bg-gray-200 dark:bg-white/10 rounded-full">
                    <div id="progressLine"
                        class="h-full bg-gradient-to-r from-primary to-purple-500 rounded-full transition-all duration-700"
                        style="width: 0%"></div>
                </div>

                <div class="relative flex justify-between" id="progressSteps">
                    <!-- Steps will be dynamically injected here -->
                </div>
            </div>

            <div class="mt-8 p-4 bg-primary/5 dark:bg-primary/10 rounded-2xl flex items-center gap-4 transition-all hover:bg-primary/10"
                id="currentStatusInfo">
                <div class="w-12 h-12 bg-primary/20 rounded-full flex items-center justify-center">
                    <span class="material-symbols-outlined text-primary" id="currentStatusIcon">hourglass_empty</span>
                </div>
                <div>
                    <p class="font-bold" id="currentStatusText">No active applications</p>
                    <p class="text-sm text-gray-500 dark:text-gray-400" id="currentStatusSubtext">Start a new
                        application to track your progress</p>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12">
            <div class="glass-card rounded-3xl p-8 hover:shadow-xl transition-all">
                <p class="text-sm text-gray-500 uppercase font-bold tracking-wider mb-2">Active Applications</p>
                <div class="flex items-center justify-between">
                    <h2 id="activeAppsCount" class="text-4xl font-bold font-display">0</h2>
                    <span class="material-symbols-outlined text-3xl text-primary">pending_actions</span>
                </div>
            </div>
            <div class="glass-card rounded-3xl p-8 hover:shadow-xl transition-all">
                <p class="text-sm text-gray-500 uppercase font-bold tracking-wider mb-2">Total Loan Amount</p>
                <div class="flex items-center justify-between">
                    <h2 id="totalLoanAmount" class="text-4xl font-bold font-display">₹0</h2>
                    <span class="material-symbols-outlined text-3xl text-green-500">payments</span>
                </div>
            </div>
            <div class="glass-card rounded-3xl p-8 hover:shadow-xl transition-all">
                <p class="text-sm text-gray-500 uppercase font-bold tracking-wider mb-2">Documents Status</p>
                <div class="flex items-center justify-between">
                    <h2 id="docStatusPercent" class="text-4xl font-bold font-display italic text-primary">0%</h2>
                    <span class="material-symbols-outlined text-3xl text-primary">fact_check</span>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-2 glass-card rounded-3xl p-8">
                <div class="flex items-center justify-between mb-8">
                    <h2 class="text-2xl font-bold">My Applications</h2>
                    <span id="appsCount" class="text-sm text-gray-500">0 applications</span>
                </div>
                <div id="applicationsContainer" class="space-y-4">
                    <div class="text-center py-12 text-gray-400">
                        <span class="material-symbols-outlined text-6xl mb-4">folder_open</span>
                        <p>No applications yet. Create your first application!</p>
                    </div>
                </div>
            </div>

            <div class="glass-card rounded-3xl p-8">
                <div class="flex items-center justify-between mb-8">
                    <h2 class="text-xl font-bold">Document Status</h2>
                    <a href="vault.html" class="text-sm font-bold text-primary hover:underline">View All</a>
                </div>
                <div id="documentStatusContainer" class="space-y-4"></div>
                <div class="mt-6 pt-6 border-t border-gray-200 dark:border-white/10">
                    <div class="flex justify-between text-sm mb-2">
                        <span class="text-gray-500">Completion</span>
                        <span id="docCompletionText" class="font-bold text-primary">0%</span>
                    </div>
                    <div class="w-full bg-gray-200 dark:bg-white/10 rounded-full h-2">
                        <div id="docProgressBar" class="bg-primary h-full rounded-full transition-all duration-500"
                            style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-8 glass-card rounded-3xl p-8">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-2xl font-bold">Recent Activity</h2>
                <button onclick="clearActivity()"
                    class="text-sm font-bold text-gray-400 hover:text-red-500 transition-colors">Clear All</button>
            </div>
            <div id="activityContainer" class="space-y-4">
                <div class="text-center py-8 text-gray-400">
                    <span class="material-symbols-outlined text-4xl mb-2">history</span>
                    <p>No recent activity</p>
                </div>
            </div>
        </div>
    </main>

    <script src="assets/js/theme-toggle.js"></script>
    <script src="assets/js/progress-tracker.js"></script>
    <script src="assets/js/dashboard.js"></script>
    <script src="assets/js/auth.js"></script>
    <script src="assets/js/components-loader.js"></script>

    <script>
        // Dashboard Data Store
        window.dashboardData = {
            applications: [],
            documents: {
                aadhar: { uploaded: false, status: 'pending' },
                pan: { uploaded: false, status: 'pending' },
                passport: { uploaded: false, status: 'pending' },
                '10th': { uploaded: false, status: 'pending' },
                '12th': { uploaded: false, status: 'pending' },
                degree: { uploaded: false, status: 'pending' },
            },
            activity: []
        };

        function loadDashboardData() {
            const userId = localStorage.getItem('userId');
            if (!userId) return;

            const saved = localStorage.getItem(`dashboardData_${userId}`);
            if (saved) {
                window.dashboardData = JSON.parse(saved);
                if (!Array.isArray(dashboardData.applications)) dashboardData.applications = [];
                if (!Array.isArray(dashboardData.activity)) dashboardData.activity = [];
                if (!dashboardData.documents) dashboardData.documents = {
                    aadhar: { uploaded: false, status: 'pending' },
                    pan: { uploaded: false, status: 'pending' },
                    passport: { uploaded: false, status: 'pending' },
                    '10th': { uploaded: false, status: 'pending' },
                    '12th': { uploaded: false, status: 'pending' },
                    degree: { uploaded: false, status: 'pending' },
                };
            }
            renderDashboard();
        }

        function saveDashboardData() {
            const userId = localStorage.getItem('userId');
            if (!userId) return;
            localStorage.setItem(`dashboardData_${userId}`, JSON.stringify(window.dashboardData));
        }

        function renderDashboard() {
            renderStats();
            renderApplications();
            renderDocumentStatus();
            renderActivity();
            if (window.progressTracker && typeof window.progressTracker.updateFromDashboardData === 'function') {
                window.progressTracker.updateFromDashboardData(window.dashboardData);
            }
        }

        function renderStats() {
            const activeApps = window.dashboardData.applications.filter(a => a.status !== 'approved' && a.status !== 'rejected').length;
            const totalAmount = window.dashboardData.applications.reduce((sum, a) => sum + (parseFloat(a.amount) || 0), 0);
            const uploadedDocs = Object.values(window.dashboardData.documents).filter(d => d.uploaded).length;
            const docPercent = Math.round((uploadedDocs / 6) * 100);

            document.getElementById('activeAppsCount').textContent = String(activeApps).padStart(2, '0');
            document.getElementById('totalLoanAmount').textContent = '₹' + formatAmount(totalAmount);
            document.getElementById('docStatusPercent').textContent = docPercent + '%';
        }

        function renderApplications() {
            const container = document.getElementById('applicationsContainer');
            const countEl = document.getElementById('appsCount');

            if (window.dashboardData.applications.length === 0) {
                container.innerHTML = `<div class="text-center py-12 text-gray-400"><span class="material-symbols-outlined text-6xl mb-4">folder_open</span><p>No applications yet. Create your first application!</p></div>`;
                countEl.textContent = '0 applications';
                return;
            }

            countEl.textContent = `${window.dashboardData.applications.length} application${window.dashboardData.applications.length > 1 ? 's' : ''}`;
            container.innerHTML = window.dashboardData.applications.map((app, index) => `
                <div class="flex items-center gap-4 p-4 rounded-2xl bg-gray-50 dark:bg-white/5 border border-gray-100 dark:border-white/5 hover:shadow-lg transition-all">
                    <div class="w-12 h-12 ${getStatusBg(app.status)} rounded-xl flex items-center justify-center ${getStatusColor(app.status)}">
                        <span class="material-symbols-outlined">${getLoanIcon(app.loanType || app.type)}</span>
                    </div>
                    <div class="flex-1">
                        <p class="font-bold">${app.bank} - ${formatLoanType(app.loanType || app.type)}</p>
                        <p class="text-sm text-gray-500">₹${formatAmount(app.amount)} • ${app.purpose || 'No description'}</p>
                    </div>
                    <div class="text-right">
                        <span class="inline-block px-3 py-1 rounded-full text-xs font-bold ${getStatusClass(app.status)}">${formatStatus(app.status)}</span>
                        <p class="text-xs text-gray-400 mt-1">${formatDate(app.date)}</p>
                    </div>
                    <button onclick="deleteApplication(${index})" class="p-2 text-gray-400 hover:text-red-500 transition-colors"><span class="material-symbols-outlined text-sm">delete</span></button>
                </div>
            `).join('');
        }

        function renderDocumentStatus() {
            const container = document.getElementById('documentStatusContainer');
            const progressBar = document.getElementById('docProgressBar');
            const completionText = document.getElementById('docCompletionText');
            const docLabels = { aadhar: 'Aadhar Card', pan: 'PAN Card', passport: 'Passport', '10th': '10th Marksheet', '12th': '12th Marksheet', degree: 'Degree Certificate' };

            container.innerHTML = Object.entries(window.dashboardData.documents).map(([key, doc]) => `
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined ${doc.uploaded ? 'text-green-500' : 'text-gray-300'}">${doc.uploaded ? 'check_circle' : 'radio_button_unchecked'}</span>
                    <span class="flex-1 text-sm ${doc.uploaded ? 'text-gray-900 dark:text-white' : 'text-gray-400'}">${docLabels[key]}</span>
                    ${doc.uploaded ? `<span class="text-xs px-2 py-1 rounded-full bg-green-100 dark:bg-green-900/20 text-green-600 dark:text-green-400">Uploaded</span>` : ''}
                </div>
            `).join('');

            const uploadedCount = Object.values(window.dashboardData.documents).filter(d => d.uploaded).length;
            const percent = Math.round((uploadedCount / 6) * 100);
            progressBar.style.width = percent + '%';
            completionText.textContent = percent + '%';
        }

        function renderActivity() {
            const container = document.getElementById('activityContainer');
            if (window.dashboardData.activity.length === 0) {
                container.innerHTML = `<div class="text-center py-8 text-gray-400"><span class="material-symbols-outlined text-4xl mb-2">history</span><p>No recent activity</p></div>`;
                return;
            }
            container.innerHTML = window.dashboardData.activity.slice(0, 15).map((act, i) => `
                <div class="activity-item flex items-center gap-4 cursor-pointer hover:bg-gray-50 dark:hover:bg-white/5 rounded-xl p-2 -mx-2 transition-colors" ${act.link ? `onclick="window.location.href='${act.link}'"` : ''} style="animation-delay: ${i * 0.05}s">
                    <div class="w-10 h-10 ${getActivityBg(act.type)} rounded-full flex items-center justify-center ${getActivityColor(act.type)} shrink-0">
                        <span class="material-symbols-outlined text-xl">${getActivityIcon(act.type)}</span>
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="font-bold text-sm">${act.title || getActivityTitle(act.type)}</p>
                        <p class="text-xs text-gray-500 truncate">${act.description}</p>
                    </div>
                    <p class="text-xs text-gray-400 shrink-0">${formatTimeAgo(act.timestamp || act.date)}</p>
                </div>
            `).join('');
        }

        function getActivityTitle(type) {
            const titles = { 'new_application': 'New Application Submitted', 'application': 'Application Submitted', 'delete': 'Application Deleted', 'upload': 'Document Uploaded', 'approved': 'Application Approved', 'rejected': 'Application Rejected', 'forum_post': 'Posted in Community Forum', 'forum_comment': 'Commented on Forum Post', 'blog_comment': 'Commented on Blog', 'post_like': 'Liked a Forum Post' };
            return titles[type] || 'Activity';
        }

        function deleteApplication(index) {
            if (confirm('Are you sure you want to delete this application?')) {
                const app = window.dashboardData.applications[index];
                if (typeof deleteApplicationAPI === 'function') {
                    deleteApplicationAPI(app.id, index);
                } else {
                    window.dashboardData.applications.splice(index, 1);
                    saveDashboardData();
                    renderDashboard();
                }
            }
        }

        function clearActivity() {
            if (confirm('Clear all activity history?')) {
                window.dashboardData.activity = [];
                saveDashboardData();
                renderActivity();
            }
        }

        function formatAmount(amount) { return new Intl.NumberFormat('en-IN').format(amount); }
        function formatLoanType(type) { const types = { education: 'Education Loan', home: 'Home Loan', personal: 'Personal Loan', business: 'Business Loan', vehicle: 'Vehicle Loan' }; return types[type] || type; }
        function getLoanIcon(type) { const icons = { education: 'school', home: 'home', personal: 'person', business: 'business', vehicle: 'directions_car' }; return icons[type] || 'account_balance'; }
        function formatStatus(status) { return status.charAt(0).toUpperCase() + status.slice(1); }
        function getStatusClass(status) { const classes = { pending: 'bg-yellow-100 text-yellow-700 dark:bg-yellow-900/20 dark:text-yellow-400', approved: 'bg-green-100 text-green-700 dark:bg-green-900/20 dark:text-green-400', rejected: 'bg-red-100 text-red-700 dark:bg-red-900/20 dark:text-red-400', processing: 'bg-blue-100 text-blue-700 dark:bg-blue-900/20 dark:text-blue-400' }; return classes[status] || classes.pending; }
        function getStatusBg(status) { const bgs = { pending: 'bg-yellow-100 dark:bg-yellow-900/20', approved: 'bg-green-100 dark:bg-green-900/20', rejected: 'bg-red-100 dark:bg-red-900/20', processing: 'bg-blue-100 dark:bg-blue-900/20' }; return bgs[status] || bgs.pending; }
        function getStatusColor(status) { const colors = { pending: 'text-yellow-600 dark:text-yellow-400', approved: 'text-green-600 dark:text-green-400', rejected: 'text-red-600 dark:text-red-400', processing: 'text-blue-600 dark:text-blue-400' }; return colors[status] || colors.pending; }
        function formatDate(dateStr) { return new Date(dateStr).toLocaleDateString('en-IN', { day: 'numeric', month: 'short', year: 'numeric' }); }
        function formatTimeAgo(dateStr) { const diff = Date.now() - new Date(dateStr).getTime(); const mins = Math.floor(diff / 60000); const hours = Math.floor(mins / 60); const days = Math.floor(hours / 24); if (mins < 1) return 'Just now'; if (mins < 60) return `${mins}m ago`; if (hours < 24) return `${hours}h ago`; if (days < 7) return `${days}d ago`; return formatDate(dateStr); }
        function getActivityIcon(type) { const icons = { application: 'description', new_application: 'add_circle', delete: 'delete', upload: 'upload_file', approved: 'check_circle', rejected: 'cancel', forum_post: 'forum', forum_comment: 'chat_bubble', blog_comment: 'rate_review', post_like: 'thumb_up' }; return icons[type] || 'info'; }
        function getActivityBg(type) { const bgs = { application: 'bg-primary/10', new_application: 'bg-green-100 dark:bg-green-900/20', delete: 'bg-red-100 dark:bg-red-900/20', upload: 'bg-blue-100 dark:bg-blue-900/20', approved: 'bg-green-100 dark:bg-green-900/20', rejected: 'bg-red-100 dark:bg-red-900/20', forum_post: 'bg-indigo-100 dark:bg-indigo-900/20', forum_comment: 'bg-teal-100 dark:bg-teal-900/20', blog_comment: 'bg-orange-100 dark:bg-orange-900/20', post_like: 'bg-pink-100 dark:bg-pink-900/20' }; return bgs[type] || 'bg-gray-100 dark:bg-white/10'; }
        function getActivityColor(type) { const colors = { application: 'text-primary', new_application: 'text-green-500', delete: 'text-red-500', upload: 'text-blue-500', approved: 'text-green-500', rejected: 'text-red-500', forum_post: 'text-indigo-500', forum_comment: 'text-teal-500', blog_comment: 'text-orange-500', post_like: 'text-pink-500' }; return colors[type] || 'text-gray-500'; }

        document.addEventListener('DOMContentLoaded', () => {
            if (typeof loadUserDashboard === 'function') loadUserDashboard();
            loadDashboardData();
        });

        window.addEventListener('storage', (e) => { if (e.key === 'dashboardData') loadDashboardData(); });
        window.addEventListener('focus', () => loadDashboardData());
        document.addEventListener('visibilitychange', () => { if (!document.hidden) loadDashboardData(); });
    </script>
</body>

</html>